{"input":{"repo":"diffview","branch":"diffview-t5f","commits":[{"hash":"8d92ad31b20f0aee9b6fdd1c9c2a90c07c72c118","message":"Add 'e' keybinding to diffstory for case saving"},{"hash":"f2d0d9c4e7442a36179cb43159b9467b1a077200","message":"Close diffview-t5f"},{"hash":"afce0a9a6efa12fea543de2a286849dbb9426f0f","message":"Add eval case capture with 'e' keybinding"},{"hash":"3bea299ffcb2d86c2973b79f9c2b891a19e94dcf","message":"Start work on diffview-t5f"}],"diff":{"Files":[{"OldPath":".beads/issues.jsonl","NewPath":".beads/issues.jsonl","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":101,"OldCount":7,"NewStart":101,"NewCount":7,"Section":"","Lines":[{"Type":0,"Content":"{\"id\":\"diffview-npu\",\"title\":\"Domain types\",\"description\":\"Root package with Diff, Hunk, Line types and Parser, Viewer interfaces. No external dependencies per Ben Johnson pattern.\",\"notes\":\"COMPLETED: Domain types (Diff, FileDiff, Hunk, Line) and interfaces (Parser, Viewer)\\nIN_PROGRESS: Self-review\\nNEXT: Code review and finish\\nKEY_DECISIONS: Used io/fs.FileMode for file modes, context.Context for Viewer cancellation\",\"status\":\"closed\",\"priority\":1,\"issue_type\":\"task\",\"created_at\":\"2025-12-23T18:48:57.465717-08:00\",\"updated_at\":\"2025-12-23T19:33:23.952374-08:00\",\"closed_at\":\"2025-12-23T19:33:23.952375-08:00\",\"dependencies\":[{\"issue_id\":\"diffview-npu\",\"depends_on_id\":\"diffview-lzy\",\"type\":\"parent-child\",\"created_at\":\"2025-12-23T18:49:41.957753-08:00\",\"created_by\":\"daemon\"}]}\n","OldLineNum":101,"NewLineNum":101,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-o5z\",\"title\":\"Update ClassificationInput for PR-level\",\"description\":\"## Problem\\nCurrent ClassificationInput has single CommitInfo. Need to support PR-level with multiple commits.\\n\\n## Changes\\n```go\\n// Before\\ntype ClassificationInput struct {\\n    Commit CommitInfo\\n    Diff   Diff\\n}\\n\\n// After\\ntype ClassificationInput struct {\\n    Repo    string        `json:\\\"repo\\\"`\\n    Branch  string        `json:\\\"branch\\\"`\\n    Commits []CommitBrief `json:\\\"commits\\\"`\\n    Diff    Diff          `json:\\\"diff\\\"`\\n}\\n\\ntype CommitBrief struct {\\n    Hash    string `json:\\\"hash\\\"`\\n    Message string `json:\\\"message\\\"`\\n}\\n```\\n\\n## Files\\n- classification.go\\n\\n## Validation\\n- [ ] New types compile\\n- [ ] make validate passes\",\"notes\":\"COMPLETED: Updated ClassificationInput for PR-level\\n- Replaced CommitInfo with CommitBrief (hash + message only)\\n- Changed Commit field to Commits slice\\n- Added Repo and Branch fields at PR level\\n- Added FirstCommitHash() and FirstCommitMessage() helper methods for migration\\n- Updated all usages in format.go, bubbletea/eval.go, cmd/diffstory/main.go\\n- Updated all tests (JSON keys now lowercase)\\n\\nREVIEW_NOTES:\\n- Judgment keying by first commit hash is a known limitation, tracked in diffview-w47\\n- Branch field not yet populated (for downstream tasks)\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-27T11:04:04.655628-08:00\",\"created_by\":\"filip\",\"updated_at\":\"2025-12-27T11:16:39.575504-08:00\",\"closed_at\":\"2025-12-27T11:16:39.575507-08:00\"}\n","OldLineNum":102,"NewLineNum":102,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-ohe\",\"title\":\"Support large diffs that exceed GitHub's render limit\",\"description\":\"## Problem\\nGitHub shows 'Diff is too big to render' for files like eval-dataset.jsonl (7.6MB). diffview should handle these gracefully.\\n\\n## Use Case\\n- Reviewing AI-generated code changes that span many files\\n- Viewing eval dataset diffs during development\\n- Any diff that exceeds GitHub's ~1MB render limit\\n\\n## Requirements\\n1. diffview should render large diffs without crashing\\n2. Consider lazy loading / virtualization for very large diffs\\n3. Test with files up to 10MB+\\n4. Provide feedback on large file loading (progress indicator?)\\n\\n## Dogfooding\\nThis came from PR #53 where eval-dataset.jsonl couldn't be viewed on GitHub.\\n\\n## Entrypoints\\n- bubbletea/viewer.go - current rendering\\n- gitdiff/parser.go - parsing large diffs\\n\\n## Validation\\n- [ ] Can view 7.6MB JSONL diff without issues\\n- [ ] Memory usage stays reasonable\\n- [ ] UI remains responsive during load\\n- [ ] make validate passes\",\"notes\":\"Tests confirm current implementation handles large diffs well (7.6MB in ~50ms, ~23MB memory). No lazy loading or virtualization was needed. Performance tests in bubbletea/large_diff_test.go provide a regression baseline.\\n\\nTest coverage:\\n- TestLargeDiff_ModelCreation: verifies model creation with large diff\\n- TestLargeDiff_Parse: verifies parsing 7.25MB diff in \\u003c5s\\n- TestLargeDiff_RenderAndView: verifies rendering large diff produces output\\n- TestLargeDiff_PerformanceBounds: asserts time \\u003c2s, memory \\u003c200MB for 7.6MB diff\\n- Benchmarks for parse, model create, and render\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-27T13:23:03.438608-08:00\",\"created_by\":\"filip\",\"updated_at\":\"2025-12-27T13:50:00.24039-08:00\",\"closed_at\":\"2025-12-27T13:50:00.24039-08:00\",\"close_reason\":\"Performance tests confirm diffview handles large diffs (7.6MB+) without issues. Existing implementation is already performant (~50ms render, ~23MB memory). No lazy loading or virtualization needed.\"}\n","OldLineNum":103,"NewLineNum":103,"NoNewline":false},{"Type":2,"Content":"{\"id\":\"diffview-p0s\",\"title\":\"Human review of classified diffs\",\"description\":\"## Problem\\nNeed human review of 30-50 classified diffs to validate classification quality and build failure taxonomy.\\n\\n## Prerequisites\\n- Evalreview critique input working\\n- Eval dataset collected and classified\\n\\n## Process (Hamel's methodology)\\n1. Load dataset: `evalreview eval-dataset.jsonl`\\n2. For each case:\\n   - Review diff + story\\n   - Pass/fail judgment\\n   - Write detailed critique (\\\"detailed enough for new employee\\\")\\n3. Target: 30-50 cases reviewed\\n\\n## Critique Guidance\\nFor failures, explain:\\n- Which hunk categories are wrong?\\n- Is change type correct?\\n- Does narrative pattern fit?\\n- Are sections sensibly grouped?\\n\\nFor passes with issues:\\n- Note any minor problems\\n- Suggest improvements\\n\\n## Output\\n- judgments JSONL with critiques\\n- Ready for axial coding\\n\\n## Validation\\n- [ ] 30+ cases reviewed\\n- [ ] Each failure has detailed critique\\n- [ ] Critiques exportable for taxonomy\",\"notes\":\"## Context from diffview-452 (section ordering)\\n\\nSection ordering is now fully LLM-driven (OrderSections() post-processing removed).\\nThe prompt instructs two-pass ordering: narrative order first, then sink fully-collapsed sections to end.\\n\\nWhen reviewing ordering issues, note whether:\\n- Fully-collapsed sections interrupt narrative flow (should be at end)\\n- Section order doesn't follow expected narrative pattern\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-26T21:34:10.107811-08:00\",\"updated_at\":\"2025-12-28T22:28:52.146218-08:00\",\"dependencies\":[{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-dft\",\"type\":\"blocks\",\"created_at\":\"2025-12-26T21:34:22.914446-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-cq1\",\"type\":\"blocks\",\"created_at\":\"2025-12-26T21:34:22.948336-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-mle\",\"type\":\"blocks\",\"created_at\":\"2025-12-27T10:53:39.100003-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-w47\",\"type\":\"blocks\",\"created_at\":\"2025-12-27T10:54:37.596857-08:00\",\"created_by\":\"daemon\"}]}\n","OldLineNum":104,"NewLineNum":0,"NoNewline":false},{"Type":1,"Content":"{\"id\":\"diffview-p0s\",\"title\":\"Human review of classified diffs\",\"description\":\"## Problem\\nNeed human review of 30-50 classified diffs to validate classification quality and build failure taxonomy.\\n\\n## Prerequisites\\n- Evalreview critique input working\\n- Eval dataset collected and classified\\n\\n## Process (Hamel's methodology)\\n1. Load dataset: `evalreview eval-dataset.jsonl`\\n2. For each case:\\n   - Review diff + story\\n   - Pass/fail judgment\\n   - Write detailed critique (\\\"detailed enough for new employee\\\")\\n3. Target: 30-50 cases reviewed\\n\\n## Critique Guidance\\nFor failures, explain:\\n- Which hunk categories are wrong?\\n- Is change type correct?\\n- Does narrative pattern fit?\\n- Are sections sensibly grouped?\\n\\nFor passes with issues:\\n- Note any minor problems\\n- Suggest improvements\\n\\n## Output\\n- judgments JSONL with critiques\\n- Ready for axial coding\\n\\n## Validation\\n- [ ] 30+ cases reviewed\\n- [ ] Each failure has detailed critique\\n- [ ] Critiques exportable for taxonomy\",\"notes\":\"## Context from diffview-452 (section ordering)\\n\\nSection ordering is now fully LLM-driven (OrderSections() post-processing removed).\\nThe prompt instructs two-pass ordering: narrative order first, then sink fully-collapsed sections to end.\\n\\nWhen reviewing ordering issues, note whether:\\n- Fully-collapsed sections interrupt narrative flow (should be at end)\\n- Section order doesn't follow expected narrative pattern\\n\\n## Integration from diffview-t5f (case capture)\\n\\nThe 'e' keybinding is now available during eval review for saving interesting cases:\\n- Curated cases go to `\\u003cinput\\u003e-curated.jsonl` (e.g., `eval-dataset-curated.jsonl`)\\n- Use to capture particularly good or bad classification examples for future eval iterations\\n- Format: EvalCase JSON (same as main dataset, not Judgment format)\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-26T21:34:10.107811-08:00\",\"updated_at\":\"2025-12-28T23:13:54.887836-08:00\",\"dependencies\":[{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-dft\",\"type\":\"blocks\",\"created_at\":\"2025-12-26T21:34:22.914446-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-cq1\",\"type\":\"blocks\",\"created_at\":\"2025-12-26T21:34:22.948336-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-mle\",\"type\":\"blocks\",\"created_at\":\"2025-12-27T10:53:39.100003-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-p0s\",\"depends_on_id\":\"diffview-w47\",\"type\":\"blocks\",\"created_at\":\"2025-12-27T10:54:37.596857-08:00\",\"created_by\":\"daemon\"}]}\n","OldLineNum":0,"NewLineNum":104,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-pgd\",\"title\":\"Add prompt formatter for classification input\",\"description\":\"## Problem\\nNeed to render `ClassificationInput` as structured text for LLM prompt.\\n\\n## Entrypoints\\n- New file: format.go or classifier.go in root package (interface)\\n- Implementation in gemini/ or new llm/ package\\n\\n## Output Format\\n```\\n\\u003ccommit_message\\u003e\\nFix authentication token expiry\\n\\nTokens were not being refreshed properly when they expired.\\n\\u003c/commit_message\\u003e\\n\\n\\u003cdiff\\u003e\\n=== FILE: pkg/auth/login.go (modified) ===\\n\\n--- HUNK H1 (@@ -45,6 +45,10 @@) ---\\n func (a *Auth) ValidateToken(token string) error {\\n+    if a.isExpired(token) {\\n+        return ErrTokenExpired\\n+    }\\n     return a.validator.Validate(token)\\n }\\n\\n--- HUNK H2 (@@ -82,3 +86,7 @@) ---\\n[more hunk content]\\n\\n=== FILE: pkg/auth/login_test.go (added) ===\\n...\\n\\u003c/diff\\u003e\\n```\\n\\n## Interface\\n```go\\ntype PromptFormatter interface {\\n    Format(input ClassificationInput) string\\n}\\n```\\n\\n## Key Details\\n- Hunk IDs use format: H1, H2, H3... (sequential across all files)\\n- File headers show operation type: modified/added/deleted/renamed\\n- Include @@ line numbers in hunk headers\\n\\n## Validation\\n- [ ] Formatter produces consistent output\\n- [ ] All hunks get unique IDs\\n- [ ] make validate passes\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-26T21:33:45.044678-08:00\",\"updated_at\":\"2025-12-26T22:17:39.672618-08:00\",\"closed_at\":\"2025-12-26T22:17:39.672618-08:00\",\"close_reason\":\"Implemented as part of epic diffview-6f7\",\"dependencies\":[{\"issue_id\":\"diffview-pgd\",\"depends_on_id\":\"diffview-ni2\",\"type\":\"blocks\",\"created_at\":\"2025-12-26T21:34:22.779362-08:00\",\"created_by\":\"daemon\"}]}\n","OldLineNum":105,"NewLineNum":105,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-pxa\",\"title\":\"Add section indicator to StoryModel status bar\",\"description\":\"## Problem\\n\\nStoryModel status bar shows file/hunk position but not which section the user is viewing. The design doc specifies showing \\\"section 2/3: Core Changes\\\" to help users understand their position in the story.\\n\\n## Approach\\n\\n1. Add `currentSection()` helper that finds which section contains the current viewport position (using `sectionPositions` similar to `currentPosition()`)\\n\\n2. Update `statusBarView()` to include section indicator:\\n   ```\\n   file 2/5 │ hunk 3/8 │ section 2/3: Core Changes │ 45% │ ...\\n   ```\\n\\n3. Handle edge cases:\\n   - No sections (story is nil or empty)\\n   - Position before first section\\n   - Truncate long section titles if needed\\n\\n## Entrypoints\\n\\n- `bubbletea/story.go` - `statusBarView()` and new `currentSection()` helper\\n\\n## Validation\\n\\n- [ ] Section indicator shows current section number and title\\n- [ ] Indicator updates when navigating with s/S\\n- [ ] Gracefully handles empty/nil story\\n- [ ] make validate passes\",\"notes\":\"COMPLETED: Section indicator implementation\\n- Added sectionIndices field to track story section index mapping\\n- Modified computeSectionPositions() to return both positions and indices\\n- Added currentSection() method to determine current section from viewport position\\n- Updated statusBarView() to show section indicator when sections exist\\n- Handle edge case: at bottom of content where viewport can't reach section position\\n\\nTESTS:\\n- TestStoryModel_SectionIndicator: verifies indicator updates with navigation\\n- TestStoryModel_SectionIndicator_NoSections: verifies no indicator when empty\\n\\nVALIDATION: make validate passes\",\"status\":\"closed\",\"priority\":3,\"issue_type\":\"task\",\"created_at\":\"2025-12-28T09:16:43.044719-08:00\",\"created_by\":\"filip\",\"updated_at\":\"2025-12-28T10:36:00.533764-08:00\",\"closed_at\":\"2025-12-28T10:36:00.533764-08:00\",\"close_reason\":\"Implemented section indicator in StoryModel status bar. Shows 'section X/Y: Title' when navigating through sections.\"}\n","OldLineNum":106,"NewLineNum":106,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-q24\",\"title\":\"Add Palette type and update Theme interface\",\"description\":\"## Problem\\nRoot package needs Palette type as domain abstraction for colors.\\n\\n## Implementation\\n1. Add `Color` type alias for hex strings\\n2. Add `Palette` struct with 18 semantic color fields:\\n   - Base: Background, Foreground\\n   - Diff: Added, Deleted, Modified, Context\\n   - Syntax: Keyword, String, Number, Comment, Operator, Function, Type, Constant, Punctuation\\n   - UI: UIBackground, UIForeground, UIAccent\\n3. Update `Theme` interface to include `Palette()` method\\n\\n## Entrypoints\\n- styles.go\\n\\n## Testing\\n- Test that Palette fields are defined (data type, no behavior)\\n- Verify Theme interface compiles with new method\\n\\n## Validation\\n- [ ] Palette type has all 18 fields\\n- [ ] Theme interface includes Palette() method\\n- [ ] make validate passes\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-25T13:53:29.350423-08:00\",\"updated_at\":\"2025-12-25T14:03:50.531729-08:00\",\"closed_at\":\"2025-12-25T14:03:50.531729-08:00\",\"close_reason\":\"Closed\"}\n","OldLineNum":107,"NewLineNum":107,"NoNewline":false}]},{"OldStart":114,"OldCount":7,"NewStart":114,"NewCount":7,"Section":"","Lines":[{"Type":0,"Content":"{\"id\":\"diffview-svh\",\"title\":\"Add line numbers in gutter column\",\"description\":\"## Problem\\nNo line numbers shown - users can't reference specific lines or correlate with their editor. Essential for code review workflows.\\n\\n## Solution\\nAdd a gutter column showing old/new line numbers:\\n```\\n  12    14  │  context line\\n  13     -  │- deleted line\\n   -    15  │+ added line\\n```\\n\\n## Implementation\\n- Track line numbers during rendering (increment from Hunk.OldStart/NewStart)\\n- Use lipgloss.JoinHorizontal to compose: lineNumStyle + separator + content\\n- Line number style: right-aligned, fixed width, muted color\\n- Show '-' for lines that don't exist on that side\\n\\n## Entrypoints\\n- bubbletea/viewer.go:210-277 (renderDiffWithPositions - add gutter rendering)\\n- diffview/styles.go (may need LineNumber ColorPair)\\n\\n## Validation\\n- [ ] Old and new line numbers shown in gutter\\n- [ ] Numbers increment correctly per line type\\n- [ ] Deleted lines show number on left, '-' on right\\n- [ ] Added lines show '-' on left, number on right\\n- [ ] Context lines show both numbers\\n- [ ] Gutter has muted styling, doesn't distract from content\\n- [ ] make validate passes\",\"notes\":\"COMPLETED: Line number gutter implementation\\n- Added LineNumber ColorPair to Styles type\\n- Added formatGutter and formatLineNum helper functions\\n- Modified renderDiffWithPositions to prepend gutter to each line\\n- Added tests for line number rendering\\n- Dark theme uses #6c7086 (muted gray)\\n- Light theme uses #9ca0b0 (lighter muted gray)\\n\\nIN_PROGRESS: Self-review\\n\\nKEY_DECISIONS:\\n- Gutter width is 4 chars per column (old/new)\\n- Format: '   1    2 │+content' with pipe separator\\n- Using '-' for missing line numbers (added/deleted lines)\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-23T23:51:20.396538-08:00\",\"updated_at\":\"2025-12-24T08:54:57.478112-08:00\",\"closed_at\":\"2025-12-24T08:54:57.478119-08:00\"}\n","OldLineNum":114,"NewLineNum":114,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-szv\",\"title\":\"Design and implement evalreview TUI\",\"description\":\"## Problem\\nNeed TUI for reviewing LLM-generated diff stories with pass/fail judgments.\\n\\n## Design Document\\nSee `docs/plans/2025-12-26-evalreview-tui-design.md` for full design.\\n\\n## Implementation Summary\\n\\n### Architecture (Ben Johnson Layout)\\n\\n**Root package** (`diffview/`):\\n- `evalreview.go` - Domain types: `EvalCase`, `Judgment`, `EvalCaseLoader`, `JudgmentStore` interfaces\\n\\n**New packages**:\\n- `jsonl/loader.go` - Implements `EvalCaseLoader`\\n- `jsonl/store.go` - Implements `JudgmentStore`\\n\\n**Extend existing**:\\n- `bubbletea/eval.go` - `EvalModel` (separate from viewer.go)\\n- `bubbletea/eval_keymap.go` - Keybindings\\n- `mock/eval.go` - Mocks for new interfaces\\n\\n**CLI**:\\n- `cmd/evalreview/main.go` - Entry point\\n\\n### UI Layout\\nVertical stack: diff panel (50%), story panel (35%), judgment bar, status bar.\\n\\n### Modes\\n- **Review mode**: Navigate cases (j/k), scroll panels (d/s + scroll keys), judge (p/f)\\n- **Critique mode**: Text input (c to enter, Esc to exit)\\n\\n### Data Flow\\n- Input: `eval/cases/*.jsonl` (EvalCase per line: commit + hunks + story)\\n- Output: `*-judgments.jsonl` (separate file, auto-saved)\\n\\n## Implementation Order\\n1. Domain types in `evalreview.go`\\n2. JSONL loader/store with tests\\n3. EvalModel core (layout, navigation, scrolling)\\n4. Judgment capture (p/f, critique, persistence)\\n5. CLI entry point\\n\\n## Validation\\n- [ ] `evalreview eval/cases/test.jsonl` launches TUI\\n- [ ] Navigate between cases with j/k\\n- [ ] Scroll diff/story independently with d/s + scroll keys\\n- [ ] Record pass/fail with p/f\\n- [ ] Enter/save critique with c/Esc\\n- [ ] Judgments persist to `*-judgments.jsonl`\\n- [ ] Re-launch loads previous judgments\\n- [ ] make validate passes\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"feature\",\"created_at\":\"2025-12-26T14:49:41.655825-08:00\",\"updated_at\":\"2025-12-26T18:09:20.623714-08:00\",\"closed_at\":\"2025-12-26T18:09:20.62372-08:00\",\"dependencies\":[{\"issue_id\":\"diffview-szv\",\"depends_on_id\":\"diffview-3zd\",\"type\":\"blocks\",\"created_at\":\"2025-12-26T14:49:52.806347-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-szv\",\"depends_on_id\":\"diffview-41i\",\"type\":\"blocks\",\"created_at\":\"2025-12-26T14:49:52.839205-08:00\",\"created_by\":\"daemon\"}]}\n","OldLineNum":115,"NewLineNum":115,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-t0x\",\"title\":\"Cache diffstory classification results by input hash\",\"description\":\"## Problem\\n\\nRunning diffstory on the same diff repeatedly re-runs LLM classification, wasting time and API calls.\\n\\n## Solution\\n\\nCache classification results keyed by input hash:\\n1. Hash the input diff content (SHA256 or similar)\\n2. Check cache before calling LLM\\n3. Store result with hash key on successful classification\\n4. Return cached result if hash matches\\n\\n## Cache Design\\n\\n- Location: `~/.cache/diffstory/` or XDG_CACHE_HOME\\n- Format: JSON files named by hash, or single SQLite DB\\n- Include metadata: timestamp, model version\\n- Consider cache expiration (or make it manual)\\n\\n## Entrypoints\\n\\n- `cmd/diffstory/main.go` - integrate cache lookup/storage\\n- New package or file for cache implementation\\n\\n## Validation\\n\\n- [ ] First run calls LLM and caches result\\n- [ ] Second run with same input returns instantly from cache\\n- [ ] Different input triggers new LLM call\\n- [ ] make validate passes\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-28T10:40:31.51192-08:00\",\"created_by\":\"filip\",\"updated_at\":\"2025-12-28T11:12:22.542354-08:00\",\"closed_at\":\"2025-12-28T11:12:22.542354-08:00\",\"close_reason\":\"Closed\"}\n","OldLineNum":116,"NewLineNum":116,"NoNewline":false},{"Type":2,"Content":"{\"id\":\"diffview-t5f\",\"title\":\"Capture current view as eval case\",\"description\":\"## Problem\\nBuilding eval dataset requires running collect command on historical commits. No way to capture interesting cases encountered during normal review workflow.\\n\\n## Proposed Solution\\nAdd a keybinding (e.g., 'e' for export to eval) that:\\n1. Saves current ClassificationInput + StoryClassification to eval JSONL file\\n2. Optionally prompts for pass/fail judgment inline\\n3. Appends to configured eval dataset path\\n\\nThis enables dogfooding - building the dataset organically from real usage rather than mining historical commits. Captures the cases users actually care about.\\n\\n## Entrypoints\\n- cmd/diffview or bubbletea UI (wherever the review UI lives)\\n\\n## Validation\\n- [ ] Can capture case from review UI with keybinding\\n- [ ] Case appears in eval dataset JSONL\\n- [ ] make validate passes\",\"status\":\"open\",\"priority\":3,\"issue_type\":\"feature\",\"created_at\":\"2025-12-27T11:27:03.831225-08:00\",\"created_by\":\"filip\",\"updated_at\":\"2025-12-27T11:27:03.831225-08:00\"}\n","OldLineNum":117,"NewLineNum":0,"NoNewline":false},{"Type":1,"Content":"{\"id\":\"diffview-t5f\",\"title\":\"Capture current view as eval case\",\"description\":\"## Problem\\nBuilding eval dataset requires running collect command on historical commits. No way to capture interesting cases encountered during normal review workflow.\\n\\n## Proposed Solution\\nAdd a keybinding (e.g., 'e' for export to eval) that:\\n1. Saves current ClassificationInput + StoryClassification to eval JSONL file\\n2. Optionally prompts for pass/fail judgment inline\\n3. Appends to configured eval dataset path\\n\\nThis enables dogfooding - building the dataset organically from real usage rather than mining historical commits. Captures the cases users actually care about.\\n\\n## Entrypoints\\n- cmd/diffview or bubbletea UI (wherever the review UI lives)\\n\\n## Validation\\n- [ ] Can capture case from review UI with keybinding\\n- [ ] Case appears in eval dataset JSONL\\n- [ ] make validate passes\",\"status\":\"closed\",\"priority\":3,\"issue_type\":\"feature\",\"created_at\":\"2025-12-27T11:27:03.831225-08:00\",\"created_by\":\"filip\",\"updated_at\":\"2025-12-28T23:14:35.88064-08:00\",\"closed_at\":\"2025-12-28T23:14:35.880643-08:00\"}\n","OldLineNum":0,"NewLineNum":117,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-tsg\",\"title\":\"Add chroma dependency and syntax token extraction\",\"description\":\"## Problem\\nNeed infrastructure for syntax highlighting using chroma library.\\n\\n## Implementation\\n1. Add github.com/alecthomas/chroma/v2 dependency\\n2. Create syntax/ package following Ben Johnson pattern\\n3. Implement token extraction using iterator API (not quick.Highlight)\\n4. Use chroma.Coalesce() wrapper for performance\\n\\n## Key Code Pattern\\n```go\\nlexer := lexers.Get(language)\\nlexer = chroma.Coalesce(lexer)\\niterator, _ := lexer.Tokenise(nil, code)\\nfor token := iterator(); token != chroma.EOF; token = iterator() {\\n    // extract foreground color, bold, text\\n}\\n```\\n\\n## Validation\\n- [ ] Token extraction works for Go code\\n- [ ] make validate passes\",\"status\":\"closed\",\"priority\":2,\"issue_type\":\"task\",\"created_at\":\"2025-12-24T20:16:00.282715-08:00\",\"updated_at\":\"2025-12-24T21:27:51.467137-08:00\",\"closed_at\":\"2025-12-24T21:27:51.467142-08:00\"}\n","OldLineNum":118,"NewLineNum":118,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-vqr\",\"title\":\"Move interface compliance checks from tests to production code\",\"description\":\"## Problem\\nInterface compliance checks (`var _ Interface = (*Type)(nil)`) are incorrectly placed in test files instead of production code. This provides runtime verification only, when we want compile-time guarantees.\\n\\n## Files to Fix\\n1. `gitdiff/parser_test.go:356` → move to `gitdiff/parser.go`\\n2. `bubbletea/viewer_test.go:29` → move to `bubbletea/viewer.go`\\n3. `lipgloss/theme_test.go:17,90,136` → move to `lipgloss/theme.go` (convert inline checks to package-level)\\n4. `chroma/tokenizer_test.go:62` → move to `chroma/tokenizer.go`\\n\\n## Validation\\n- [ ] All interface checks are in production files, not test files\\n- [ ] No functional changes - just moving declarations\\n- [ ] make validate passes\",\"status\":\"closed\",\"priority\":3,\"issue_type\":\"task\",\"created_at\":\"2025-12-25T13:18:38.449466-08:00\",\"updated_at\":\"2025-12-25T14:17:34.075341-08:00\",\"closed_at\":\"2025-12-25T14:17:34.075341-08:00\",\"close_reason\":\"Closed\"}\n","OldLineNum":119,"NewLineNum":119,"NoNewline":false},{"Type":0,"Content":"{\"id\":\"diffview-w0d\",\"title\":\"Parser implementation\",\"description\":\"gitdiff/ package using bluekeyes/go-gitdiff. Parses unified diff, flattens file-centric to hunk-centric, computes line numbers.\",\"notes\":\"COMPLETED: Parser implementation with go-gitdiff\\n- Created gitdiff/ package with Parser type\\n- Implements diffview.Parser interface\\n- Parses unified diff format, handles all file operations (add/delete/modify/rename/copy)\\n- Computes line numbers for old and new files\\n- Handles binary files, no-newline-at-EOF markers\\n- 8 passing tests covering all major scenarios\\n\\nKEY_DECISIONS:\\n- Package named 'gitdiff' after the dependency (Ben Johnson pattern)\\n- go-gitdiff strips a/b prefixes from paths (library behavior, not added back)\",\"status\":\"closed\",\"priority\":1,\"issue_type\":\"task\",\"created_at\":\"2025-12-23T18:49:11.479258-08:00\",\"updated_at\":\"2025-12-23T20:18:47.669586-08:00\",\"closed_at\":\"2025-12-23T20:18:47.669589-08:00\",\"dependencies\":[{\"issue_id\":\"diffview-w0d\",\"depends_on_id\":\"diffview-lzy\",\"type\":\"parent-child\",\"created_at\":\"2025-12-23T18:49:42.042751-08:00\",\"created_by\":\"daemon\"},{\"issue_id\":\"diffview-w0d\",\"depends_on_id\":\"diffview-npu\",\"type\":\"blocks\",\"created_at\":\"2025-12-23T18:49:53.383597-08:00\",\"created_by\":\"daemon\"}]}\n","OldLineNum":120,"NewLineNum":120,"NoNewline":false}]}],"Extended":null},{"OldPath":"bubbletea/eval.go","NewPath":"bubbletea/eval.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":64,"OldCount":6,"NewStart":64,"NewCount":10,"Section":"type EvalModel struct {","Lines":[{"Type":0,"Content":"\t// Clipboard\n","OldLineNum":64,"NewLineNum":64,"NoNewline":false},{"Type":0,"Content":"\tclipboard diffview.Clipboard\n","OldLineNum":65,"NewLineNum":65,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":66,"NewLineNum":66,"NoNewline":false},{"Type":1,"Content":"\t// Case saving\n","OldLineNum":0,"NewLineNum":67,"NoNewline":false},{"Type":1,"Content":"\tcaseSaver     diffview.EvalCaseSaver\n","OldLineNum":0,"NewLineNum":68,"NoNewline":false},{"Type":1,"Content":"\tcaseSaverPath string\n","OldLineNum":0,"NewLineNum":69,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":70,"NoNewline":false},{"Type":0,"Content":"\t// Keybindings\n","OldLineNum":67,"NewLineNum":71,"NoNewline":false},{"Type":0,"Content":"\tkeymap EvalKeyMap\n","OldLineNum":68,"NewLineNum":72,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":69,"NewLineNum":73,"NoNewline":false}]},{"OldStart":124,"OldCount":6,"NewStart":128,"NewCount":14,"Section":"func WithClipboard(c diffview.Clipboard) EvalModelOption {","Lines":[{"Type":0,"Content":"\t}\n","OldLineNum":124,"NewLineNum":128,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":125,"NewLineNum":129,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":126,"NewLineNum":130,"NoNewline":false},{"Type":1,"Content":"// WithCaseSaver sets the saver for exporting cases to an eval dataset.\n","OldLineNum":0,"NewLineNum":131,"NoNewline":false},{"Type":1,"Content":"func WithCaseSaver(s diffview.EvalCaseSaver, path string) EvalModelOption {\n","OldLineNum":0,"NewLineNum":132,"NoNewline":false},{"Type":1,"Content":"\treturn func(m *EvalModel) {\n","OldLineNum":0,"NewLineNum":133,"NoNewline":false},{"Type":1,"Content":"\t\tm.caseSaver = s\n","OldLineNum":0,"NewLineNum":134,"NoNewline":false},{"Type":1,"Content":"\t\tm.caseSaverPath = path\n","OldLineNum":0,"NewLineNum":135,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":136,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":137,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":138,"NoNewline":false},{"Type":0,"Content":"// NewEvalModel creates a new EvalModel with the given cases.\n","OldLineNum":127,"NewLineNum":139,"NoNewline":false},{"Type":0,"Content":"func NewEvalModel(cases []diffview.EvalCase, opts ...EvalModelOption) EvalModel {\n","OldLineNum":128,"NewLineNum":140,"NoNewline":false},{"Type":0,"Content":"\tm := EvalModel{\n","OldLineNum":129,"NewLineNum":141,"NoNewline":false}]},{"OldStart":278,"OldCount":6,"NewStart":290,"NewCount":10,"Section":"func (m EvalModel) handleReviewKeys(msg tea.KeyMsg) (tea.Model, tea.Cmd) {","Lines":[{"Type":0,"Content":"\t\tm.copyCurrentCase()\n","OldLineNum":278,"NewLineNum":290,"NoNewline":false},{"Type":0,"Content":"\t\treturn m, nil\n","OldLineNum":279,"NewLineNum":291,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":280,"NewLineNum":292,"NoNewline":false},{"Type":1,"Content":"\tcase key.Matches(msg, m.keymap.SaveCase):\n","OldLineNum":0,"NewLineNum":293,"NoNewline":false},{"Type":1,"Content":"\t\tm.saveCurrentCase()\n","OldLineNum":0,"NewLineNum":294,"NoNewline":false},{"Type":1,"Content":"\t\treturn m, nil\n","OldLineNum":0,"NewLineNum":295,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":296,"NoNewline":false},{"Type":0,"Content":"\tcase key.Matches(msg, m.keymap.Help):\n","OldLineNum":281,"NewLineNum":297,"NoNewline":false},{"Type":0,"Content":"\t\tm.mode = ModeHelp\n","OldLineNum":282,"NewLineNum":298,"NoNewline":false},{"Type":0,"Content":"\t\treturn m, nil\n","OldLineNum":283,"NewLineNum":299,"NoNewline":false}]},{"OldStart":533,"OldCount":6,"NewStart":549,"NewCount":16,"Section":"func (m *EvalModel) copyCurrentCase() {","Lines":[{"Type":0,"Content":"\t_ = m.clipboard.Copy(content)\n","OldLineNum":533,"NewLineNum":549,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":534,"NewLineNum":550,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":535,"NewLineNum":551,"NoNewline":false},{"Type":1,"Content":"func (m *EvalModel) saveCurrentCase() {\n","OldLineNum":0,"NewLineNum":552,"NoNewline":false},{"Type":1,"Content":"\tif m.caseSaver == nil || m.caseSaverPath == \"\" || len(m.cases) == 0 {\n","OldLineNum":0,"NewLineNum":553,"NoNewline":false},{"Type":1,"Content":"\t\treturn\n","OldLineNum":0,"NewLineNum":554,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":555,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":556,"NoNewline":false},{"Type":1,"Content":"\tc := m.cases[m.currentIndex]\n","OldLineNum":0,"NewLineNum":557,"NoNewline":false},{"Type":1,"Content":"\t// Best-effort save - errors are silently ignored in UI\n","OldLineNum":0,"NewLineNum":558,"NoNewline":false},{"Type":1,"Content":"\t_ = m.caseSaver.Save(m.caseSaverPath, c)\n","OldLineNum":0,"NewLineNum":559,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":560,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":561,"NoNewline":false},{"Type":0,"Content":"// formatCaseForExport formats an EvalCase as markdown for LLM-assisted review.\n","OldLineNum":536,"NewLineNum":562,"NoNewline":false},{"Type":0,"Content":"func formatCaseForExport(c diffview.EvalCase) string {\n","OldLineNum":537,"NewLineNum":563,"NoNewline":false},{"Type":0,"Content":"\tvar sb strings.Builder\n","OldLineNum":538,"NewLineNum":564,"NoNewline":false}]},{"OldStart":733,"OldCount":6,"NewStart":759,"NewCount":7,"Section":"func (m EvalModel) renderHelpView() string {","Lines":[{"Type":0,"Content":"\ts.WriteString(headerStyle.Render(\"Other\"))\n","OldLineNum":733,"NewLineNum":759,"NoNewline":false},{"Type":0,"Content":"\ts.WriteString(\"\\n\")\n","OldLineNum":734,"NewLineNum":760,"NoNewline":false},{"Type":0,"Content":"\ts.WriteString(fmt.Sprintf(\"  %s    %s\\n\", keyStyle.Render(\"y\"), descStyle.Render(\"copy case to clipboard\")))\n","OldLineNum":735,"NewLineNum":761,"NoNewline":false},{"Type":1,"Content":"\ts.WriteString(fmt.Sprintf(\"  %s    %s\\n\", keyStyle.Render(\"e\"), descStyle.Render(\"save case to eval dataset\")))\n","OldLineNum":0,"NewLineNum":762,"NoNewline":false},{"Type":0,"Content":"\ts.WriteString(fmt.Sprintf(\"  %s    %s\\n\", keyStyle.Render(\"?\"), descStyle.Render(\"toggle help\")))\n","OldLineNum":736,"NewLineNum":763,"NoNewline":false},{"Type":0,"Content":"\ts.WriteString(fmt.Sprintf(\"  %s    %s\\n\", keyStyle.Render(\"q\"), descStyle.Render(\"quit\")))\n","OldLineNum":737,"NewLineNum":764,"NoNewline":false},{"Type":0,"Content":"\ts.WriteString(\"\\n\\n\")\n","OldLineNum":738,"NewLineNum":765,"NoNewline":false}]}],"Extended":null},{"OldPath":"bubbletea/eval_keymap.go","NewPath":"bubbletea/eval_keymap.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":35,"OldCount":6,"NewStart":35,"NewCount":7,"Section":"type EvalKeyMap struct {","Lines":[{"Type":0,"Content":"\n","OldLineNum":35,"NewLineNum":35,"NoNewline":false},{"Type":0,"Content":"\t// Export\n","OldLineNum":36,"NewLineNum":36,"NoNewline":false},{"Type":0,"Content":"\tCopyCase key.Binding\n","OldLineNum":37,"NewLineNum":37,"NoNewline":false},{"Type":1,"Content":"\tSaveCase key.Binding\n","OldLineNum":0,"NewLineNum":38,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":38,"NewLineNum":39,"NoNewline":false},{"Type":0,"Content":"\t// General\n","OldLineNum":39,"NewLineNum":40,"NoNewline":false},{"Type":0,"Content":"\tQuit key.Binding\n","OldLineNum":40,"NewLineNum":41,"NoNewline":false}]},{"OldStart":116,"OldCount":6,"NewStart":117,"NewCount":10,"Section":"func DefaultEvalKeyMap() EvalKeyMap {","Lines":[{"Type":0,"Content":"\t\t\tkey.WithKeys(\"y\"),\n","OldLineNum":116,"NewLineNum":117,"NoNewline":false},{"Type":0,"Content":"\t\t\tkey.WithHelp(\"y\", \"copy case to clipboard\"),\n","OldLineNum":117,"NewLineNum":118,"NoNewline":false},{"Type":0,"Content":"\t\t),\n","OldLineNum":118,"NewLineNum":119,"NoNewline":false},{"Type":1,"Content":"\t\tSaveCase: key.NewBinding(\n","OldLineNum":0,"NewLineNum":120,"NoNewline":false},{"Type":1,"Content":"\t\t\tkey.WithKeys(\"e\"),\n","OldLineNum":0,"NewLineNum":121,"NoNewline":false},{"Type":1,"Content":"\t\t\tkey.WithHelp(\"e\", \"save case to eval dataset\"),\n","OldLineNum":0,"NewLineNum":122,"NoNewline":false},{"Type":1,"Content":"\t\t),\n","OldLineNum":0,"NewLineNum":123,"NoNewline":false},{"Type":0,"Content":"\t\tQuit: key.NewBinding(\n","OldLineNum":119,"NewLineNum":124,"NoNewline":false},{"Type":0,"Content":"\t\t\tkey.WithKeys(\"q\", \"ctrl+c\"),\n","OldLineNum":120,"NewLineNum":125,"NoNewline":false},{"Type":0,"Content":"\t\t\tkey.WithHelp(\"q\", \"quit\"),\n","OldLineNum":121,"NewLineNum":126,"NoNewline":false}]}],"Extended":null},{"OldPath":"bubbletea/eval_test.go","NewPath":"bubbletea/eval_test.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":855,"OldCount":3,"NewStart":855,"NewCount":83,"Section":"func TestEvalModel_HelpOverlayShowsOnQuestionMark(t *testing.T) {","Lines":[{"Type":0,"Content":"\ttm.Send(tea.KeyMsg{Type: tea.KeyRunes, Runes: []rune{'q'}})\n","OldLineNum":855,"NewLineNum":855,"NoNewline":false},{"Type":0,"Content":"\ttm.WaitFinished(t, teatest.WithFinalTimeout(0))\n","OldLineNum":856,"NewLineNum":856,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":857,"NewLineNum":857,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":858,"NoNewline":false},{"Type":1,"Content":"func TestEvalModel_SaveCaseToEvalDataset(t *testing.T) {\n","OldLineNum":0,"NewLineNum":859,"NoNewline":false},{"Type":1,"Content":"\tt.Parallel()\n","OldLineNum":0,"NewLineNum":860,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":861,"NoNewline":false},{"Type":1,"Content":"\tcases := []diffview.EvalCase{\n","OldLineNum":0,"NewLineNum":862,"NoNewline":false},{"Type":1,"Content":"\t\t{\n","OldLineNum":0,"NewLineNum":863,"NoNewline":false},{"Type":1,"Content":"\t\t\tInput: diffview.ClassificationInput{\n","OldLineNum":0,"NewLineNum":864,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tRepo:    \"test-repo\",\n","OldLineNum":0,"NewLineNum":865,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tBranch:  \"feature-branch\",\n","OldLineNum":0,"NewLineNum":866,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tCommits: []diffview.CommitBrief{{Hash: \"abc123\", Message: \"Add feature\"}},\n","OldLineNum":0,"NewLineNum":867,"NoNewline":false},{"Type":1,"Content":"\t\t\t},\n","OldLineNum":0,"NewLineNum":868,"NoNewline":false},{"Type":1,"Content":"\t\t\tStory: \u0026diffview.StoryClassification{\n","OldLineNum":0,"NewLineNum":869,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tChangeType: \"feature\",\n","OldLineNum":0,"NewLineNum":870,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tSummary:    \"Added a new feature\",\n","OldLineNum":0,"NewLineNum":871,"NoNewline":false},{"Type":1,"Content":"\t\t\t},\n","OldLineNum":0,"NewLineNum":872,"NoNewline":false},{"Type":1,"Content":"\t\t},\n","OldLineNum":0,"NewLineNum":873,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":874,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":875,"NoNewline":false},{"Type":1,"Content":"\t// Create a mock saver to capture the saved case\n","OldLineNum":0,"NewLineNum":876,"NoNewline":false},{"Type":1,"Content":"\tmockSaver := \u0026mockCaseSaver{}\n","OldLineNum":0,"NewLineNum":877,"NoNewline":false},{"Type":1,"Content":"\tm := bubbletea.NewEvalModel(cases,\n","OldLineNum":0,"NewLineNum":878,"NoNewline":false},{"Type":1,"Content":"\t\tbubbletea.WithCaseSaver(mockSaver, \"/tmp/eval-cases.jsonl\"),\n","OldLineNum":0,"NewLineNum":879,"NoNewline":false},{"Type":1,"Content":"\t)\n","OldLineNum":0,"NewLineNum":880,"NoNewline":false},{"Type":1,"Content":"\ttm := teatest.NewTestModel(t, m,\n","OldLineNum":0,"NewLineNum":881,"NoNewline":false},{"Type":1,"Content":"\t\tteatest.WithInitialTermSize(100, 40),\n","OldLineNum":0,"NewLineNum":882,"NoNewline":false},{"Type":1,"Content":"\t)\n","OldLineNum":0,"NewLineNum":883,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":884,"NoNewline":false},{"Type":1,"Content":"\t// Wait for model to be ready\n","OldLineNum":0,"NewLineNum":885,"NoNewline":false},{"Type":1,"Content":"\tteatest.WaitFor(t, tm.Output(), func(out []byte) bool {\n","OldLineNum":0,"NewLineNum":886,"NoNewline":false},{"Type":1,"Content":"\t\treturn bytes.Contains(out, []byte(\"Added a new feature\"))\n","OldLineNum":0,"NewLineNum":887,"NoNewline":false},{"Type":1,"Content":"\t})\n","OldLineNum":0,"NewLineNum":888,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":889,"NoNewline":false},{"Type":1,"Content":"\t// Press 'e' to save case to eval dataset\n","OldLineNum":0,"NewLineNum":890,"NoNewline":false},{"Type":1,"Content":"\ttm.Send(tea.KeyMsg{Type: tea.KeyRunes, Runes: []rune{'e'}})\n","OldLineNum":0,"NewLineNum":891,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":892,"NoNewline":false},{"Type":1,"Content":"\t// Wait for the save to happen\n","OldLineNum":0,"NewLineNum":893,"NoNewline":false},{"Type":1,"Content":"\tteatest.WaitFor(t, tm.Output(), func(_ []byte) bool {\n","OldLineNum":0,"NewLineNum":894,"NoNewline":false},{"Type":1,"Content":"\t\treturn mockSaver.SavedCase() != nil\n","OldLineNum":0,"NewLineNum":895,"NoNewline":false},{"Type":1,"Content":"\t})\n","OldLineNum":0,"NewLineNum":896,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":897,"NoNewline":false},{"Type":1,"Content":"\t// Verify the saved case\n","OldLineNum":0,"NewLineNum":898,"NoNewline":false},{"Type":1,"Content":"\tsaved := mockSaver.SavedCase()\n","OldLineNum":0,"NewLineNum":899,"NoNewline":false},{"Type":1,"Content":"\tassert.NotNil(t, saved)\n","OldLineNum":0,"NewLineNum":900,"NoNewline":false},{"Type":1,"Content":"\tassert.Equal(t, \"test-repo\", saved.Input.Repo)\n","OldLineNum":0,"NewLineNum":901,"NoNewline":false},{"Type":1,"Content":"\tassert.Equal(t, \"feature-branch\", saved.Input.Branch)\n","OldLineNum":0,"NewLineNum":902,"NoNewline":false},{"Type":1,"Content":"\tassert.Equal(t, \"feature\", saved.Story.ChangeType)\n","OldLineNum":0,"NewLineNum":903,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":904,"NoNewline":false},{"Type":1,"Content":"\t// Verify the path was passed correctly\n","OldLineNum":0,"NewLineNum":905,"NoNewline":false},{"Type":1,"Content":"\tassert.Equal(t, \"/tmp/eval-cases.jsonl\", mockSaver.SavedPath())\n","OldLineNum":0,"NewLineNum":906,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":907,"NoNewline":false},{"Type":1,"Content":"\ttm.Send(tea.KeyMsg{Type: tea.KeyRunes, Runes: []rune{'q'}})\n","OldLineNum":0,"NewLineNum":908,"NoNewline":false},{"Type":1,"Content":"\ttm.WaitFinished(t, teatest.WithFinalTimeout(0))\n","OldLineNum":0,"NewLineNum":909,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":910,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":911,"NoNewline":false},{"Type":1,"Content":"// mockCaseSaver captures saved cases for testing.\n","OldLineNum":0,"NewLineNum":912,"NoNewline":false},{"Type":1,"Content":"type mockCaseSaver struct {\n","OldLineNum":0,"NewLineNum":913,"NoNewline":false},{"Type":1,"Content":"\tmu        sync.Mutex\n","OldLineNum":0,"NewLineNum":914,"NoNewline":false},{"Type":1,"Content":"\tsavedCase *diffview.EvalCase\n","OldLineNum":0,"NewLineNum":915,"NoNewline":false},{"Type":1,"Content":"\tsavedPath string\n","OldLineNum":0,"NewLineNum":916,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":917,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":918,"NoNewline":false},{"Type":1,"Content":"func (m *mockCaseSaver) Save(path string, c diffview.EvalCase) error {\n","OldLineNum":0,"NewLineNum":919,"NoNewline":false},{"Type":1,"Content":"\tm.mu.Lock()\n","OldLineNum":0,"NewLineNum":920,"NoNewline":false},{"Type":1,"Content":"\tdefer m.mu.Unlock()\n","OldLineNum":0,"NewLineNum":921,"NoNewline":false},{"Type":1,"Content":"\tm.savedCase = \u0026c\n","OldLineNum":0,"NewLineNum":922,"NoNewline":false},{"Type":1,"Content":"\tm.savedPath = path\n","OldLineNum":0,"NewLineNum":923,"NoNewline":false},{"Type":1,"Content":"\treturn nil\n","OldLineNum":0,"NewLineNum":924,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":925,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":926,"NoNewline":false},{"Type":1,"Content":"func (m *mockCaseSaver) SavedCase() *diffview.EvalCase {\n","OldLineNum":0,"NewLineNum":927,"NoNewline":false},{"Type":1,"Content":"\tm.mu.Lock()\n","OldLineNum":0,"NewLineNum":928,"NoNewline":false},{"Type":1,"Content":"\tdefer m.mu.Unlock()\n","OldLineNum":0,"NewLineNum":929,"NoNewline":false},{"Type":1,"Content":"\treturn m.savedCase\n","OldLineNum":0,"NewLineNum":930,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":931,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":932,"NoNewline":false},{"Type":1,"Content":"func (m *mockCaseSaver) SavedPath() string {\n","OldLineNum":0,"NewLineNum":933,"NoNewline":false},{"Type":1,"Content":"\tm.mu.Lock()\n","OldLineNum":0,"NewLineNum":934,"NoNewline":false},{"Type":1,"Content":"\tdefer m.mu.Unlock()\n","OldLineNum":0,"NewLineNum":935,"NoNewline":false},{"Type":1,"Content":"\treturn m.savedPath\n","OldLineNum":0,"NewLineNum":936,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":937,"NoNewline":false}]}],"Extended":null},{"OldPath":"bubbletea/story.go","NewPath":"bubbletea/story.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":31,"OldCount":6,"NewStart":31,"NewCount":11,"Section":"type StoryModel struct {","Lines":[{"Type":0,"Content":"\ttokenizer        diffview.Tokenizer\n","OldLineNum":31,"NewLineNum":31,"NoNewline":false},{"Type":0,"Content":"\twordDiffer       diffview.WordDiffer\n","OldLineNum":32,"NewLineNum":32,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":33,"NewLineNum":33,"NoNewline":false},{"Type":1,"Content":"\t// Case saving\n","OldLineNum":0,"NewLineNum":34,"NoNewline":false},{"Type":1,"Content":"\tinput         *diffview.ClassificationInput // optional: full input for constructing EvalCase\n","OldLineNum":0,"NewLineNum":35,"NoNewline":false},{"Type":1,"Content":"\tcaseSaver     diffview.EvalCaseSaver\n","OldLineNum":0,"NewLineNum":36,"NoNewline":false},{"Type":1,"Content":"\tcaseSaverPath string\n","OldLineNum":0,"NewLineNum":37,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":38,"NoNewline":false},{"Type":0,"Content":"\t// UI state\n","OldLineNum":34,"NewLineNum":39,"NoNewline":false},{"Type":0,"Content":"\tviewport   viewport.Model\n","OldLineNum":35,"NewLineNum":40,"NoNewline":false},{"Type":0,"Content":"\tkeymap     StoryKeyMap\n","OldLineNum":36,"NewLineNum":41,"NoNewline":false}]},{"OldStart":52,"OldCount":6,"NewStart":57,"NewCount":9,"Section":"type storyModelConfig struct {","Lines":[{"Type":0,"Content":"\ttokenizer        diffview.Tokenizer\n","OldLineNum":52,"NewLineNum":57,"NoNewline":false},{"Type":0,"Content":"\twordDiffer       diffview.WordDiffer\n","OldLineNum":53,"NewLineNum":58,"NoNewline":false},{"Type":0,"Content":"\tshowIntro        bool\n","OldLineNum":54,"NewLineNum":59,"NoNewline":false},{"Type":1,"Content":"\tinput            *diffview.ClassificationInput\n","OldLineNum":0,"NewLineNum":60,"NoNewline":false},{"Type":1,"Content":"\tcaseSaver        diffview.EvalCaseSaver\n","OldLineNum":0,"NewLineNum":61,"NoNewline":false},{"Type":1,"Content":"\tcaseSaverPath    string\n","OldLineNum":0,"NewLineNum":62,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":55,"NewLineNum":63,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":56,"NewLineNum":64,"NoNewline":false},{"Type":0,"Content":"// WithStoryRenderer sets a custom lipgloss renderer for the model.\n","OldLineNum":57,"NewLineNum":65,"NoNewline":false}]},{"OldStart":97,"OldCount":6,"NewStart":105,"NewCount":21,"Section":"func WithIntroSlide() StoryModelOption {","Lines":[{"Type":0,"Content":"\t}\n","OldLineNum":97,"NewLineNum":105,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":98,"NewLineNum":106,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":99,"NewLineNum":107,"NoNewline":false},{"Type":1,"Content":"// WithStoryInput sets the classification input for constructing EvalCase when saving.\n","OldLineNum":0,"NewLineNum":108,"NoNewline":false},{"Type":1,"Content":"func WithStoryInput(input diffview.ClassificationInput) StoryModelOption {\n","OldLineNum":0,"NewLineNum":109,"NoNewline":false},{"Type":1,"Content":"\treturn func(cfg *storyModelConfig) {\n","OldLineNum":0,"NewLineNum":110,"NoNewline":false},{"Type":1,"Content":"\t\tcfg.input = \u0026input\n","OldLineNum":0,"NewLineNum":111,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":112,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":113,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":114,"NoNewline":false},{"Type":1,"Content":"// WithStoryCaseSaver sets the saver for exporting cases to an eval dataset.\n","OldLineNum":0,"NewLineNum":115,"NoNewline":false},{"Type":1,"Content":"func WithStoryCaseSaver(s diffview.EvalCaseSaver, path string) StoryModelOption {\n","OldLineNum":0,"NewLineNum":116,"NoNewline":false},{"Type":1,"Content":"\treturn func(cfg *storyModelConfig) {\n","OldLineNum":0,"NewLineNum":117,"NoNewline":false},{"Type":1,"Content":"\t\tcfg.caseSaver = s\n","OldLineNum":0,"NewLineNum":118,"NoNewline":false},{"Type":1,"Content":"\t\tcfg.caseSaverPath = path\n","OldLineNum":0,"NewLineNum":119,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":120,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":121,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":122,"NoNewline":false},{"Type":0,"Content":"// NewStoryModel creates a new StoryModel with the given diff and classification.\n","OldLineNum":100,"NewLineNum":123,"NoNewline":false},{"Type":0,"Content":"func NewStoryModel(diff *diffview.Diff, story *diffview.StoryClassification, opts ...StoryModelOption) StoryModel {\n","OldLineNum":101,"NewLineNum":124,"NoNewline":false},{"Type":0,"Content":"\tcfg := \u0026storyModelConfig{}\n","OldLineNum":102,"NewLineNum":125,"NoNewline":false}]},{"OldStart":148,"OldCount":6,"NewStart":171,"NewCount":9,"Section":"func NewStoryModel(diff *diffview.Diff, story *diffview.StoryClassification, opt","Lines":[{"Type":0,"Content":"\t\tlanguageDetector: cfg.languageDetector,\n","OldLineNum":148,"NewLineNum":171,"NoNewline":false},{"Type":0,"Content":"\t\ttokenizer:        cfg.tokenizer,\n","OldLineNum":149,"NewLineNum":172,"NoNewline":false},{"Type":0,"Content":"\t\twordDiffer:       cfg.wordDiffer,\n","OldLineNum":150,"NewLineNum":173,"NoNewline":false},{"Type":1,"Content":"\t\tinput:            cfg.input,\n","OldLineNum":0,"NewLineNum":174,"NoNewline":false},{"Type":1,"Content":"\t\tcaseSaver:        cfg.caseSaver,\n","OldLineNum":0,"NewLineNum":175,"NoNewline":false},{"Type":1,"Content":"\t\tcaseSaverPath:    cfg.caseSaverPath,\n","OldLineNum":0,"NewLineNum":176,"NoNewline":false},{"Type":0,"Content":"\t\tkeymap:           DefaultStoryKeyMap(),\n","OldLineNum":151,"NewLineNum":177,"NoNewline":false},{"Type":0,"Content":"\t\tstyles:           styles,\n","OldLineNum":152,"NewLineNum":178,"NoNewline":false},{"Type":0,"Content":"\t\tpalette:          palette,\n","OldLineNum":153,"NewLineNum":179,"NoNewline":false}]},{"OldStart":210,"OldCount":6,"NewStart":236,"NewCount":9,"Section":"func (m StoryModel) Update(msg tea.Msg) (tea.Model, tea.Cmd) {","Lines":[{"Type":0,"Content":"\t\tcase key.Matches(msg, m.keymap.ToggleCollapseAll):\n","OldLineNum":210,"NewLineNum":236,"NoNewline":false},{"Type":0,"Content":"\t\t\tm.toggleAllCollapse()\n","OldLineNum":211,"NewLineNum":237,"NoNewline":false},{"Type":0,"Content":"\t\t\treturn m, nil\n","OldLineNum":212,"NewLineNum":238,"NoNewline":false},{"Type":1,"Content":"\t\tcase key.Matches(msg, m.keymap.SaveCase):\n","OldLineNum":0,"NewLineNum":239,"NoNewline":false},{"Type":1,"Content":"\t\t\tm.saveCurrentCase()\n","OldLineNum":0,"NewLineNum":240,"NoNewline":false},{"Type":1,"Content":"\t\t\treturn m, nil\n","OldLineNum":0,"NewLineNum":241,"NoNewline":false},{"Type":0,"Content":"\t\t}\n","OldLineNum":213,"NewLineNum":242,"NoNewline":false},{"Type":0,"Content":"\tcase tea.WindowSizeMsg:\n","OldLineNum":214,"NewLineNum":243,"NoNewline":false},{"Type":0,"Content":"\t\tstatusBarHeight := 1\n","OldLineNum":215,"NewLineNum":244,"NoNewline":false}]},{"OldStart":534,"OldCount":6,"NewStart":563,"NewCount":19,"Section":"func (m *StoryModel) gotoPrevSection() {","Lines":[{"Type":0,"Content":"\t}\n","OldLineNum":534,"NewLineNum":563,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":535,"NewLineNum":564,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":536,"NewLineNum":565,"NoNewline":false},{"Type":1,"Content":"func (m *StoryModel) saveCurrentCase() {\n","OldLineNum":0,"NewLineNum":566,"NoNewline":false},{"Type":1,"Content":"\tif m.caseSaver == nil || m.caseSaverPath == \"\" || m.input == nil || m.story == nil {\n","OldLineNum":0,"NewLineNum":567,"NoNewline":false},{"Type":1,"Content":"\t\treturn\n","OldLineNum":0,"NewLineNum":568,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":569,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":570,"NoNewline":false},{"Type":1,"Content":"\tevalCase := diffview.EvalCase{\n","OldLineNum":0,"NewLineNum":571,"NoNewline":false},{"Type":1,"Content":"\t\tInput: *m.input,\n","OldLineNum":0,"NewLineNum":572,"NoNewline":false},{"Type":1,"Content":"\t\tStory: m.story,\n","OldLineNum":0,"NewLineNum":573,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":574,"NoNewline":false},{"Type":1,"Content":"\t// Best-effort save - errors are silently ignored in UI\n","OldLineNum":0,"NewLineNum":575,"NoNewline":false},{"Type":1,"Content":"\t_ = m.caseSaver.Save(m.caseSaverPath, evalCase)\n","OldLineNum":0,"NewLineNum":576,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":577,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":578,"NoNewline":false},{"Type":0,"Content":"// newStyle creates a new lipgloss style using the model's renderer.\n","OldLineNum":537,"NewLineNum":579,"NoNewline":false},{"Type":0,"Content":"func (m StoryModel) newStyle() lipgloss.Style {\n","OldLineNum":538,"NewLineNum":580,"NoNewline":false},{"Type":0,"Content":"\tif m.renderer != nil {\n","OldLineNum":539,"NewLineNum":581,"NoNewline":false}]},{"OldStart":582,"OldCount":7,"NewStart":624,"NewCount":7,"Section":"func (m StoryModel) statusBarView() string {","Lines":[{"Type":0,"Content":"\t}\n","OldLineNum":582,"NewLineNum":624,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":583,"NewLineNum":625,"NoNewline":false},{"Type":0,"Content":"\tcontent += barStyle.Render(scrollPos) + sep +\n","OldLineNum":584,"NewLineNum":626,"NoNewline":false},{"Type":2,"Content":"\t\tdimStyle.Render(\"j/k:scroll  s/S:section  o:collapse  z:all  q:quit\") +\n","OldLineNum":585,"NewLineNum":0,"NoNewline":false},{"Type":1,"Content":"\t\tdimStyle.Render(\"j/k:scroll  s/S:section  o:collapse  z:all  e:save  q:quit\") +\n","OldLineNum":0,"NewLineNum":627,"NoNewline":false},{"Type":0,"Content":"\t\tbarStyle.Render(\"  \")\n","OldLineNum":586,"NewLineNum":628,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":587,"NewLineNum":629,"NoNewline":false},{"Type":0,"Content":"\t// Right-align by padding left side with background\n","OldLineNum":588,"NewLineNum":630,"NoNewline":false}]}],"Extended":null},{"OldPath":"bubbletea/story_keymap.go","NewPath":"bubbletea/story_keymap.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":26,"OldCount":6,"NewStart":26,"NewCount":9,"Section":"type StoryKeyMap struct {","Lines":[{"Type":0,"Content":"\t// Hunk collapsing (story-specific)\n","OldLineNum":26,"NewLineNum":26,"NoNewline":false},{"Type":0,"Content":"\tToggleCollapse    key.Binding\n","OldLineNum":27,"NewLineNum":27,"NoNewline":false},{"Type":0,"Content":"\tToggleCollapseAll key.Binding\n","OldLineNum":28,"NewLineNum":28,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":29,"NoNewline":false},{"Type":1,"Content":"\t// Export\n","OldLineNum":0,"NewLineNum":30,"NoNewline":false},{"Type":1,"Content":"\tSaveCase key.Binding\n","OldLineNum":0,"NewLineNum":31,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":29,"NewLineNum":32,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":30,"NewLineNum":33,"NoNewline":false},{"Type":0,"Content":"// DefaultStoryKeyMap returns the default key bindings for story mode.\n","OldLineNum":31,"NewLineNum":34,"NoNewline":false}]},{"OldStart":91,"OldCount":5,"NewStart":94,"NewCount":9,"Section":"func DefaultStoryKeyMap() StoryKeyMap {","Lines":[{"Type":0,"Content":"\t\t\tkey.WithKeys(\"z\"),\n","OldLineNum":91,"NewLineNum":94,"NoNewline":false},{"Type":0,"Content":"\t\t\tkey.WithHelp(\"z\", \"toggle all collapsed\"),\n","OldLineNum":92,"NewLineNum":95,"NoNewline":false},{"Type":0,"Content":"\t\t),\n","OldLineNum":93,"NewLineNum":96,"NoNewline":false},{"Type":1,"Content":"\t\tSaveCase: key.NewBinding(\n","OldLineNum":0,"NewLineNum":97,"NoNewline":false},{"Type":1,"Content":"\t\t\tkey.WithKeys(\"e\"),\n","OldLineNum":0,"NewLineNum":98,"NoNewline":false},{"Type":1,"Content":"\t\t\tkey.WithHelp(\"e\", \"save case to eval dataset\"),\n","OldLineNum":0,"NewLineNum":99,"NoNewline":false},{"Type":1,"Content":"\t\t),\n","OldLineNum":0,"NewLineNum":100,"NoNewline":false},{"Type":0,"Content":"\t}\n","OldLineNum":94,"NewLineNum":101,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":95,"NewLineNum":102,"NoNewline":false}]}],"Extended":null},{"OldPath":"bubbletea/story_test.go","NewPath":"bubbletea/story_test.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":3,"OldCount":6,"NewStart":3,"NewCount":7,"Section":"package bubbletea_test","Lines":[{"Type":0,"Content":"import (\n","OldLineNum":3,"NewLineNum":3,"NoNewline":false},{"Type":0,"Content":"\t\"bytes\"\n","OldLineNum":4,"NewLineNum":4,"NoNewline":false},{"Type":0,"Content":"\t\"io\"\n","OldLineNum":5,"NewLineNum":5,"NoNewline":false},{"Type":1,"Content":"\t\"sync\"\n","OldLineNum":0,"NewLineNum":6,"NoNewline":false},{"Type":0,"Content":"\t\"testing\"\n","OldLineNum":6,"NewLineNum":7,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":7,"NewLineNum":8,"NoNewline":false},{"Type":0,"Content":"\ttea \"github.com/charmbracelet/bubbletea\"\n","OldLineNum":8,"NewLineNum":9,"NoNewline":false}]},{"OldStart":899,"OldCount":3,"NewStart":900,"NewCount":118,"Section":"func TestStoryModel_ExpandedHunksGetFullStyling(t *testing.T) {","Lines":[{"Type":0,"Content":"\ttm.Send(tea.KeyMsg{Type: tea.KeyRunes, Runes: []rune{'q'}})\n","OldLineNum":899,"NewLineNum":900,"NoNewline":false},{"Type":0,"Content":"\ttm.WaitFinished(t, teatest.WithFinalTimeout(0))\n","OldLineNum":900,"NewLineNum":901,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":901,"NewLineNum":902,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":903,"NoNewline":false},{"Type":1,"Content":"func TestStoryModel_SaveCaseToEvalDataset(t *testing.T) {\n","OldLineNum":0,"NewLineNum":904,"NoNewline":false},{"Type":1,"Content":"\tt.Parallel()\n","OldLineNum":0,"NewLineNum":905,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":906,"NoNewline":false},{"Type":1,"Content":"\tdiff := \u0026diffview.Diff{\n","OldLineNum":0,"NewLineNum":907,"NoNewline":false},{"Type":1,"Content":"\t\tFiles: []diffview.FileDiff{\n","OldLineNum":0,"NewLineNum":908,"NoNewline":false},{"Type":1,"Content":"\t\t\t{\n","OldLineNum":0,"NewLineNum":909,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tNewPath:   \"main.go\",\n","OldLineNum":0,"NewLineNum":910,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tOperation: diffview.FileModified,\n","OldLineNum":0,"NewLineNum":911,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tHunks: []diffview.Hunk{\n","OldLineNum":0,"NewLineNum":912,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t{\n","OldLineNum":0,"NewLineNum":913,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t\tOldStart: 1, OldCount: 1, NewStart: 1, NewCount: 2,\n","OldLineNum":0,"NewLineNum":914,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t\tLines: []diffview.Line{\n","OldLineNum":0,"NewLineNum":915,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t\t\t{Type: diffview.LineContext, Content: \"package main\"},\n","OldLineNum":0,"NewLineNum":916,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t\t\t{Type: diffview.LineAdded, Content: \"// new comment\"},\n","OldLineNum":0,"NewLineNum":917,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t\t},\n","OldLineNum":0,"NewLineNum":918,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t},\n","OldLineNum":0,"NewLineNum":919,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t},\n","OldLineNum":0,"NewLineNum":920,"NoNewline":false},{"Type":1,"Content":"\t\t\t},\n","OldLineNum":0,"NewLineNum":921,"NoNewline":false},{"Type":1,"Content":"\t\t},\n","OldLineNum":0,"NewLineNum":922,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":923,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":924,"NoNewline":false},{"Type":1,"Content":"\tstory := \u0026diffview.StoryClassification{\n","OldLineNum":0,"NewLineNum":925,"NoNewline":false},{"Type":1,"Content":"\t\tChangeType: \"feature\",\n","OldLineNum":0,"NewLineNum":926,"NoNewline":false},{"Type":1,"Content":"\t\tSummary:    \"Added a comment\",\n","OldLineNum":0,"NewLineNum":927,"NoNewline":false},{"Type":1,"Content":"\t\tSections: []diffview.Section{\n","OldLineNum":0,"NewLineNum":928,"NoNewline":false},{"Type":1,"Content":"\t\t\t{Role: \"core\", Title: \"Main Changes\", Hunks: []diffview.HunkRef{{File: \"main.go\", HunkIndex: 0}}},\n","OldLineNum":0,"NewLineNum":929,"NoNewline":false},{"Type":1,"Content":"\t\t},\n","OldLineNum":0,"NewLineNum":930,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":931,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":932,"NoNewline":false},{"Type":1,"Content":"\tinput := diffview.ClassificationInput{\n","OldLineNum":0,"NewLineNum":933,"NoNewline":false},{"Type":1,"Content":"\t\tRepo:   \"test-repo\",\n","OldLineNum":0,"NewLineNum":934,"NoNewline":false},{"Type":1,"Content":"\t\tBranch: \"feature-branch\",\n","OldLineNum":0,"NewLineNum":935,"NoNewline":false},{"Type":1,"Content":"\t\tCommits: []diffview.CommitBrief{\n","OldLineNum":0,"NewLineNum":936,"NoNewline":false},{"Type":1,"Content":"\t\t\t{Hash: \"abc123\", Message: \"Add comment\"},\n","OldLineNum":0,"NewLineNum":937,"NoNewline":false},{"Type":1,"Content":"\t\t},\n","OldLineNum":0,"NewLineNum":938,"NoNewline":false},{"Type":1,"Content":"\t\tDiff: *diff,\n","OldLineNum":0,"NewLineNum":939,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":940,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":941,"NoNewline":false},{"Type":1,"Content":"\t// Create mock saver\n","OldLineNum":0,"NewLineNum":942,"NoNewline":false},{"Type":1,"Content":"\tmockSaver := \u0026storyCaseSaver{}\n","OldLineNum":0,"NewLineNum":943,"NoNewline":false},{"Type":1,"Content":"\tm := bubbletea.NewStoryModel(diff, story,\n","OldLineNum":0,"NewLineNum":944,"NoNewline":false},{"Type":1,"Content":"\t\tbubbletea.WithStoryInput(input),\n","OldLineNum":0,"NewLineNum":945,"NoNewline":false},{"Type":1,"Content":"\t\tbubbletea.WithStoryCaseSaver(mockSaver, \"/tmp/curated.jsonl\"),\n","OldLineNum":0,"NewLineNum":946,"NoNewline":false},{"Type":1,"Content":"\t)\n","OldLineNum":0,"NewLineNum":947,"NoNewline":false},{"Type":1,"Content":"\ttm := teatest.NewTestModel(t, m,\n","OldLineNum":0,"NewLineNum":948,"NoNewline":false},{"Type":1,"Content":"\t\tteatest.WithInitialTermSize(100, 40),\n","OldLineNum":0,"NewLineNum":949,"NoNewline":false},{"Type":1,"Content":"\t)\n","OldLineNum":0,"NewLineNum":950,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":951,"NoNewline":false},{"Type":1,"Content":"\t// Wait for model to be ready\n","OldLineNum":0,"NewLineNum":952,"NoNewline":false},{"Type":1,"Content":"\tteatest.WaitFor(t, tm.Output(), func(out []byte) bool {\n","OldLineNum":0,"NewLineNum":953,"NoNewline":false},{"Type":1,"Content":"\t\treturn bytes.Contains(out, []byte(\"main.go\"))\n","OldLineNum":0,"NewLineNum":954,"NoNewline":false},{"Type":1,"Content":"\t})\n","OldLineNum":0,"NewLineNum":955,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":956,"NoNewline":false},{"Type":1,"Content":"\t// Press 'e' to save case\n","OldLineNum":0,"NewLineNum":957,"NoNewline":false},{"Type":1,"Content":"\ttm.Send(tea.KeyMsg{Type: tea.KeyRunes, Runes: []rune{'e'}})\n","OldLineNum":0,"NewLineNum":958,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":959,"NoNewline":false},{"Type":1,"Content":"\t// Wait for save to happen\n","OldLineNum":0,"NewLineNum":960,"NoNewline":false},{"Type":1,"Content":"\tteatest.WaitFor(t, tm.Output(), func(_ []byte) bool {\n","OldLineNum":0,"NewLineNum":961,"NoNewline":false},{"Type":1,"Content":"\t\treturn mockSaver.Saved()\n","OldLineNum":0,"NewLineNum":962,"NoNewline":false},{"Type":1,"Content":"\t})\n","OldLineNum":0,"NewLineNum":963,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":964,"NoNewline":false},{"Type":1,"Content":"\t// Verify the saved case\n","OldLineNum":0,"NewLineNum":965,"NoNewline":false},{"Type":1,"Content":"\tsavedCase := mockSaver.SavedCase()\n","OldLineNum":0,"NewLineNum":966,"NoNewline":false},{"Type":1,"Content":"\tif savedCase == nil {\n","OldLineNum":0,"NewLineNum":967,"NoNewline":false},{"Type":1,"Content":"\t\tt.Fatal(\"expected case to be saved\")\n","OldLineNum":0,"NewLineNum":968,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":969,"NoNewline":false},{"Type":1,"Content":"\tif savedCase.Input.Repo != \"test-repo\" {\n","OldLineNum":0,"NewLineNum":970,"NoNewline":false},{"Type":1,"Content":"\t\tt.Errorf(\"expected repo 'test-repo', got %q\", savedCase.Input.Repo)\n","OldLineNum":0,"NewLineNum":971,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":972,"NoNewline":false},{"Type":1,"Content":"\tif savedCase.Story.ChangeType != \"feature\" {\n","OldLineNum":0,"NewLineNum":973,"NoNewline":false},{"Type":1,"Content":"\t\tt.Errorf(\"expected change type 'feature', got %q\", savedCase.Story.ChangeType)\n","OldLineNum":0,"NewLineNum":974,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":975,"NoNewline":false},{"Type":1,"Content":"\tif mockSaver.SavedPath() != \"/tmp/curated.jsonl\" {\n","OldLineNum":0,"NewLineNum":976,"NoNewline":false},{"Type":1,"Content":"\t\tt.Errorf(\"expected path '/tmp/curated.jsonl', got %q\", mockSaver.SavedPath())\n","OldLineNum":0,"NewLineNum":977,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":978,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":979,"NoNewline":false},{"Type":1,"Content":"\ttm.Send(tea.KeyMsg{Type: tea.KeyRunes, Runes: []rune{'q'}})\n","OldLineNum":0,"NewLineNum":980,"NoNewline":false},{"Type":1,"Content":"\ttm.WaitFinished(t, teatest.WithFinalTimeout(0))\n","OldLineNum":0,"NewLineNum":981,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":982,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":983,"NoNewline":false},{"Type":1,"Content":"// storyCaseSaver is a mock for testing case saving in StoryModel.\n","OldLineNum":0,"NewLineNum":984,"NoNewline":false},{"Type":1,"Content":"type storyCaseSaver struct {\n","OldLineNum":0,"NewLineNum":985,"NoNewline":false},{"Type":1,"Content":"\tmu        sync.Mutex\n","OldLineNum":0,"NewLineNum":986,"NoNewline":false},{"Type":1,"Content":"\tsaved     bool\n","OldLineNum":0,"NewLineNum":987,"NoNewline":false},{"Type":1,"Content":"\tsavedCase *diffview.EvalCase\n","OldLineNum":0,"NewLineNum":988,"NoNewline":false},{"Type":1,"Content":"\tsavedPath string\n","OldLineNum":0,"NewLineNum":989,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":990,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":991,"NoNewline":false},{"Type":1,"Content":"func (s *storyCaseSaver) Save(path string, c diffview.EvalCase) error {\n","OldLineNum":0,"NewLineNum":992,"NoNewline":false},{"Type":1,"Content":"\ts.mu.Lock()\n","OldLineNum":0,"NewLineNum":993,"NoNewline":false},{"Type":1,"Content":"\tdefer s.mu.Unlock()\n","OldLineNum":0,"NewLineNum":994,"NoNewline":false},{"Type":1,"Content":"\ts.saved = true\n","OldLineNum":0,"NewLineNum":995,"NoNewline":false},{"Type":1,"Content":"\ts.savedCase = \u0026c\n","OldLineNum":0,"NewLineNum":996,"NoNewline":false},{"Type":1,"Content":"\ts.savedPath = path\n","OldLineNum":0,"NewLineNum":997,"NoNewline":false},{"Type":1,"Content":"\treturn nil\n","OldLineNum":0,"NewLineNum":998,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":999,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":1000,"NoNewline":false},{"Type":1,"Content":"func (s *storyCaseSaver) Saved() bool {\n","OldLineNum":0,"NewLineNum":1001,"NoNewline":false},{"Type":1,"Content":"\ts.mu.Lock()\n","OldLineNum":0,"NewLineNum":1002,"NoNewline":false},{"Type":1,"Content":"\tdefer s.mu.Unlock()\n","OldLineNum":0,"NewLineNum":1003,"NoNewline":false},{"Type":1,"Content":"\treturn s.saved\n","OldLineNum":0,"NewLineNum":1004,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":1005,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":1006,"NoNewline":false},{"Type":1,"Content":"func (s *storyCaseSaver) SavedCase() *diffview.EvalCase {\n","OldLineNum":0,"NewLineNum":1007,"NoNewline":false},{"Type":1,"Content":"\ts.mu.Lock()\n","OldLineNum":0,"NewLineNum":1008,"NoNewline":false},{"Type":1,"Content":"\tdefer s.mu.Unlock()\n","OldLineNum":0,"NewLineNum":1009,"NoNewline":false},{"Type":1,"Content":"\treturn s.savedCase\n","OldLineNum":0,"NewLineNum":1010,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":1011,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":1012,"NoNewline":false},{"Type":1,"Content":"func (s *storyCaseSaver) SavedPath() string {\n","OldLineNum":0,"NewLineNum":1013,"NoNewline":false},{"Type":1,"Content":"\ts.mu.Lock()\n","OldLineNum":0,"NewLineNum":1014,"NoNewline":false},{"Type":1,"Content":"\tdefer s.mu.Unlock()\n","OldLineNum":0,"NewLineNum":1015,"NoNewline":false},{"Type":1,"Content":"\treturn s.savedPath\n","OldLineNum":0,"NewLineNum":1016,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":1017,"NoNewline":false}]}],"Extended":null},{"OldPath":"cmd/diffstory/main.go","NewPath":"cmd/diffstory/main.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":7,"OldCount":6,"NewStart":7,"NewCount":7,"Section":"import (","Lines":[{"Type":0,"Content":"\t\"io\"\n","OldLineNum":7,"NewLineNum":7,"NoNewline":false},{"Type":0,"Content":"\t\"os\"\n","OldLineNum":8,"NewLineNum":8,"NoNewline":false},{"Type":0,"Content":"\t\"os/signal\"\n","OldLineNum":9,"NewLineNum":9,"NoNewline":false},{"Type":1,"Content":"\t\"path/filepath\"\n","OldLineNum":0,"NewLineNum":10,"NoNewline":false},{"Type":0,"Content":"\t\"strings\"\n","OldLineNum":10,"NewLineNum":11,"NoNewline":false},{"Type":0,"Content":"\t\"syscall\"\n","OldLineNum":11,"NewLineNum":12,"NoNewline":false},{"Type":0,"Content":"\t\"time\"\n","OldLineNum":12,"NewLineNum":13,"NoNewline":false}]},{"OldStart":20,"OldCount":6,"NewStart":21,"NewCount":7,"Section":"import (","Lines":[{"Type":0,"Content":"\t\"github.com/fwojciec/diffview/gemini\"\n","OldLineNum":20,"NewLineNum":21,"NoNewline":false},{"Type":0,"Content":"\t\"github.com/fwojciec/diffview/git\"\n","OldLineNum":21,"NewLineNum":22,"NoNewline":false},{"Type":0,"Content":"\t\"github.com/fwojciec/diffview/gitdiff\"\n","OldLineNum":22,"NewLineNum":23,"NoNewline":false},{"Type":1,"Content":"\t\"github.com/fwojciec/diffview/jsonl\"\n","OldLineNum":0,"NewLineNum":24,"NoNewline":false},{"Type":0,"Content":"\t\"github.com/fwojciec/diffview/lipgloss\"\n","OldLineNum":23,"NewLineNum":25,"NoNewline":false},{"Type":0,"Content":"\t\"github.com/fwojciec/diffview/worddiff\"\n","OldLineNum":24,"NewLineNum":26,"NoNewline":false},{"Type":0,"Content":")\n","OldLineNum":25,"NewLineNum":27,"NoNewline":false}]},{"OldStart":208,"OldCount":6,"NewStart":210,"NewCount":17,"Section":"func run() error {","Lines":[{"Type":0,"Content":"\t\treturn err\n","OldLineNum":208,"NewLineNum":210,"NoNewline":false},{"Type":0,"Content":"\t}\n","OldLineNum":209,"NewLineNum":211,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":210,"NewLineNum":212,"NoNewline":false},{"Type":1,"Content":"\t// Get commits for ClassificationInput\n","OldLineNum":0,"NewLineNum":213,"NoNewline":false},{"Type":1,"Content":"\tcommits, _ := gitRunner.CommitsInRange(ctx, cwd, baseBranch, \"HEAD\")\n","OldLineNum":0,"NewLineNum":214,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":215,"NoNewline":false},{"Type":1,"Content":"\t// Build ClassificationInput for case saving\n","OldLineNum":0,"NewLineNum":216,"NoNewline":false},{"Type":1,"Content":"\tclassInput := diffview.ClassificationInput{\n","OldLineNum":0,"NewLineNum":217,"NoNewline":false},{"Type":1,"Content":"\t\tRepo:    filepath.Base(cwd),\n","OldLineNum":0,"NewLineNum":218,"NoNewline":false},{"Type":1,"Content":"\t\tBranch:  currentBranch,\n","OldLineNum":0,"NewLineNum":219,"NoNewline":false},{"Type":1,"Content":"\t\tCommits: commits,\n","OldLineNum":0,"NewLineNum":220,"NoNewline":false},{"Type":1,"Content":"\t\tDiff:    *diff,\n","OldLineNum":0,"NewLineNum":221,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":222,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":223,"NoNewline":false},{"Type":0,"Content":"\t// Set up syntax highlighting\n","OldLineNum":211,"NewLineNum":224,"NoNewline":false},{"Type":0,"Content":"\ttheme := lipgloss.DefaultTheme()\n","OldLineNum":212,"NewLineNum":225,"NoNewline":false},{"Type":0,"Content":"\tdetector := chroma.NewDetector()\n","OldLineNum":213,"NewLineNum":226,"NoNewline":false}]},{"OldStart":216,"OldCount":6,"NewStart":229,"NewCount":9,"Section":"func run() error {","Lines":[{"Type":0,"Content":"\t\treturn fmt.Errorf(\"failed to set up syntax highlighting: %w\", err)\n","OldLineNum":216,"NewLineNum":229,"NoNewline":false},{"Type":0,"Content":"\t}\n","OldLineNum":217,"NewLineNum":230,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":218,"NewLineNum":231,"NoNewline":false},{"Type":1,"Content":"\t// Curated cases go to a fixed location in cwd\n","OldLineNum":0,"NewLineNum":232,"NoNewline":false},{"Type":1,"Content":"\tcuratedPath := filepath.Join(cwd, \"eval-curated.jsonl\")\n","OldLineNum":0,"NewLineNum":233,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":234,"NoNewline":false},{"Type":0,"Content":"\t// Launch StoryModel TUI\n","OldLineNum":219,"NewLineNum":235,"NoNewline":false},{"Type":0,"Content":"\tm := bubbletea.NewStoryModel(diff, classification,\n","OldLineNum":220,"NewLineNum":236,"NoNewline":false},{"Type":0,"Content":"\t\tbubbletea.WithStoryTheme(theme),\n","OldLineNum":221,"NewLineNum":237,"NoNewline":false}]},{"OldStart":223,"OldCount":6,"NewStart":239,"NewCount":8,"Section":"func run() error {","Lines":[{"Type":0,"Content":"\t\tbubbletea.WithStoryTokenizer(tokenizer),\n","OldLineNum":223,"NewLineNum":239,"NoNewline":false},{"Type":0,"Content":"\t\tbubbletea.WithStoryWordDiffer(worddiff.NewDiffer()),\n","OldLineNum":224,"NewLineNum":240,"NoNewline":false},{"Type":0,"Content":"\t\tbubbletea.WithIntroSlide(),\n","OldLineNum":225,"NewLineNum":241,"NoNewline":false},{"Type":1,"Content":"\t\tbubbletea.WithStoryInput(classInput),\n","OldLineNum":0,"NewLineNum":242,"NoNewline":false},{"Type":1,"Content":"\t\tbubbletea.WithStoryCaseSaver(jsonl.NewSaver(), curatedPath),\n","OldLineNum":0,"NewLineNum":243,"NoNewline":false},{"Type":0,"Content":"\t)\n","OldLineNum":226,"NewLineNum":244,"NoNewline":false},{"Type":0,"Content":"\tp := tea.NewProgram(m,\n","OldLineNum":227,"NewLineNum":245,"NoNewline":false},{"Type":0,"Content":"\t\ttea.WithAltScreen(),\n","OldLineNum":228,"NewLineNum":246,"NoNewline":false}]}],"Extended":null},{"OldPath":"cmd/evalreview/main.go","NewPath":"cmd/evalreview/main.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":73,"OldCount":6,"NewStart":73,"NewCount":16,"Section":"With a .jsonl file: opens the review UI`)","Lines":[{"Type":0,"Content":"\t}\n","OldLineNum":73,"NewLineNum":73,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":74,"NewLineNum":74,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":75,"NewLineNum":75,"NoNewline":false},{"Type":1,"Content":"// curatedPath returns the path for saving curated cases given an input path.\n","OldLineNum":0,"NewLineNum":76,"NoNewline":false},{"Type":1,"Content":"// foo.jsonl -\u003e foo-curated.jsonl\n","OldLineNum":0,"NewLineNum":77,"NoNewline":false},{"Type":1,"Content":"func curatedPath(inputPath string) string {\n","OldLineNum":0,"NewLineNum":78,"NoNewline":false},{"Type":1,"Content":"\tdir := filepath.Dir(inputPath)\n","OldLineNum":0,"NewLineNum":79,"NoNewline":false},{"Type":1,"Content":"\tbase := filepath.Base(inputPath)\n","OldLineNum":0,"NewLineNum":80,"NoNewline":false},{"Type":1,"Content":"\text := filepath.Ext(base)\n","OldLineNum":0,"NewLineNum":81,"NoNewline":false},{"Type":1,"Content":"\tname := strings.TrimSuffix(base, ext)\n","OldLineNum":0,"NewLineNum":82,"NoNewline":false},{"Type":1,"Content":"\treturn filepath.Join(dir, name+\"-curated\"+ext)\n","OldLineNum":0,"NewLineNum":83,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":84,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":85,"NoNewline":false},{"Type":0,"Content":"func runReview(ctx context.Context, inputPath string) error {\n","OldLineNum":76,"NewLineNum":86,"NoNewline":false},{"Type":0,"Content":"\t// Load cases\n","OldLineNum":77,"NewLineNum":87,"NoNewline":false},{"Type":0,"Content":"\tloader := jsonl.NewLoader()\n","OldLineNum":78,"NewLineNum":88,"NoNewline":false}]},{"OldStart":109,"OldCount":6,"NewStart":119,"NewCount":7,"Section":"func runReview(ctx context.Context, inputPath string) error {","Lines":[{"Type":0,"Content":"\t\tbubbletea.WithEvalTokenizer(tokenizer),\n","OldLineNum":109,"NewLineNum":119,"NoNewline":false},{"Type":0,"Content":"\t\tbubbletea.WithEvalWordDiffer(worddiff.NewDiffer()),\n","OldLineNum":110,"NewLineNum":120,"NoNewline":false},{"Type":0,"Content":"\t\tbubbletea.WithClipboard(clipboard.NewPBCopy()),\n","OldLineNum":111,"NewLineNum":121,"NoNewline":false},{"Type":1,"Content":"\t\tbubbletea.WithCaseSaver(jsonl.NewSaver(), curatedPath(inputPath)),\n","OldLineNum":0,"NewLineNum":122,"NoNewline":false},{"Type":0,"Content":"\t}\n","OldLineNum":112,"NewLineNum":123,"NoNewline":false},{"Type":0,"Content":"\tif len(existingJudgments) \u003e 0 {\n","OldLineNum":113,"NewLineNum":124,"NoNewline":false},{"Type":0,"Content":"\t\topts = append(opts, bubbletea.WithExistingJudgments(existingJudgments))\n","OldLineNum":114,"NewLineNum":125,"NoNewline":false}]}],"Extended":null},{"OldPath":"evalreview.go","NewPath":"evalreview.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":33,"OldCount":3,"NewStart":33,"NewCount":8,"Section":"type JudgmentStore interface {","Lines":[{"Type":0,"Content":"type Clipboard interface {\n","OldLineNum":33,"NewLineNum":33,"NoNewline":false},{"Type":0,"Content":"\tCopy(content string) error\n","OldLineNum":34,"NewLineNum":34,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":35,"NewLineNum":35,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":36,"NoNewline":false},{"Type":1,"Content":"// EvalCaseSaver appends eval cases to a file.\n","OldLineNum":0,"NewLineNum":37,"NoNewline":false},{"Type":1,"Content":"type EvalCaseSaver interface {\n","OldLineNum":0,"NewLineNum":38,"NoNewline":false},{"Type":1,"Content":"\tSave(path string, c EvalCase) error\n","OldLineNum":0,"NewLineNum":39,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":40,"NoNewline":false}]}],"Extended":null},{"OldPath":"","NewPath":"jsonl/saver.go","Operation":1,"IsBinary":false,"OldMode":0,"NewMode":33188,"Hunks":[{"OldStart":0,"OldCount":0,"NewStart":1,"NewCount":46,"Section":"","Lines":[{"Type":1,"Content":"package jsonl\n","OldLineNum":0,"NewLineNum":1,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":2,"NoNewline":false},{"Type":1,"Content":"import (\n","OldLineNum":0,"NewLineNum":3,"NoNewline":false},{"Type":1,"Content":"\t\"encoding/json\"\n","OldLineNum":0,"NewLineNum":4,"NoNewline":false},{"Type":1,"Content":"\t\"os\"\n","OldLineNum":0,"NewLineNum":5,"NoNewline":false},{"Type":1,"Content":"\t\"path/filepath\"\n","OldLineNum":0,"NewLineNum":6,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":7,"NoNewline":false},{"Type":1,"Content":"\t\"github.com/fwojciec/diffview\"\n","OldLineNum":0,"NewLineNum":8,"NoNewline":false},{"Type":1,"Content":")\n","OldLineNum":0,"NewLineNum":9,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":10,"NoNewline":false},{"Type":1,"Content":"// Compile-time interface verification.\n","OldLineNum":0,"NewLineNum":11,"NoNewline":false},{"Type":1,"Content":"var _ diffview.EvalCaseSaver = (*Saver)(nil)\n","OldLineNum":0,"NewLineNum":12,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":13,"NoNewline":false},{"Type":1,"Content":"// Saver appends EvalCase records to JSONL files.\n","OldLineNum":0,"NewLineNum":14,"NoNewline":false},{"Type":1,"Content":"type Saver struct{}\n","OldLineNum":0,"NewLineNum":15,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":16,"NoNewline":false},{"Type":1,"Content":"// NewSaver creates a new Saver.\n","OldLineNum":0,"NewLineNum":17,"NoNewline":false},{"Type":1,"Content":"func NewSaver() *Saver {\n","OldLineNum":0,"NewLineNum":18,"NoNewline":false},{"Type":1,"Content":"\treturn \u0026Saver{}\n","OldLineNum":0,"NewLineNum":19,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":20,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":21,"NoNewline":false},{"Type":1,"Content":"// Save appends an EvalCase to a JSONL file, creating parent directories if needed.\n","OldLineNum":0,"NewLineNum":22,"NoNewline":false},{"Type":1,"Content":"func (s *Saver) Save(path string, c diffview.EvalCase) error {\n","OldLineNum":0,"NewLineNum":23,"NoNewline":false},{"Type":1,"Content":"\tif err := os.MkdirAll(filepath.Dir(path), 0o755); err != nil {\n","OldLineNum":0,"NewLineNum":24,"NoNewline":false},{"Type":1,"Content":"\t\treturn err\n","OldLineNum":0,"NewLineNum":25,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":26,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":27,"NoNewline":false},{"Type":1,"Content":"\tf, err := os.OpenFile(path, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0o644)\n","OldLineNum":0,"NewLineNum":28,"NoNewline":false},{"Type":1,"Content":"\tif err != nil {\n","OldLineNum":0,"NewLineNum":29,"NoNewline":false},{"Type":1,"Content":"\t\treturn err\n","OldLineNum":0,"NewLineNum":30,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":31,"NoNewline":false},{"Type":1,"Content":"\tdefer f.Close()\n","OldLineNum":0,"NewLineNum":32,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":33,"NoNewline":false},{"Type":1,"Content":"\tdata, err := json.Marshal(c)\n","OldLineNum":0,"NewLineNum":34,"NoNewline":false},{"Type":1,"Content":"\tif err != nil {\n","OldLineNum":0,"NewLineNum":35,"NoNewline":false},{"Type":1,"Content":"\t\treturn err\n","OldLineNum":0,"NewLineNum":36,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":37,"NoNewline":false},{"Type":1,"Content":"\tif _, err := f.Write(data); err != nil {\n","OldLineNum":0,"NewLineNum":38,"NoNewline":false},{"Type":1,"Content":"\t\treturn err\n","OldLineNum":0,"NewLineNum":39,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":40,"NoNewline":false},{"Type":1,"Content":"\tif _, err := f.WriteString(\"\\n\"); err != nil {\n","OldLineNum":0,"NewLineNum":41,"NoNewline":false},{"Type":1,"Content":"\t\treturn err\n","OldLineNum":0,"NewLineNum":42,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":43,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":44,"NoNewline":false},{"Type":1,"Content":"\treturn nil\n","OldLineNum":0,"NewLineNum":45,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":46,"NoNewline":false}]}],"Extended":null},{"OldPath":"","NewPath":"jsonl/saver_test.go","Operation":1,"IsBinary":false,"OldMode":0,"NewMode":33188,"Hunks":[{"OldStart":0,"OldCount":0,"NewStart":1,"NewCount":113,"Section":"","Lines":[{"Type":1,"Content":"package jsonl_test\n","OldLineNum":0,"NewLineNum":1,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":2,"NoNewline":false},{"Type":1,"Content":"import (\n","OldLineNum":0,"NewLineNum":3,"NoNewline":false},{"Type":1,"Content":"\t\"os\"\n","OldLineNum":0,"NewLineNum":4,"NoNewline":false},{"Type":1,"Content":"\t\"path/filepath\"\n","OldLineNum":0,"NewLineNum":5,"NoNewline":false},{"Type":1,"Content":"\t\"testing\"\n","OldLineNum":0,"NewLineNum":6,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":7,"NoNewline":false},{"Type":1,"Content":"\t\"github.com/fwojciec/diffview\"\n","OldLineNum":0,"NewLineNum":8,"NoNewline":false},{"Type":1,"Content":"\t\"github.com/fwojciec/diffview/jsonl\"\n","OldLineNum":0,"NewLineNum":9,"NoNewline":false},{"Type":1,"Content":"\t\"github.com/stretchr/testify/assert\"\n","OldLineNum":0,"NewLineNum":10,"NoNewline":false},{"Type":1,"Content":"\t\"github.com/stretchr/testify/require\"\n","OldLineNum":0,"NewLineNum":11,"NoNewline":false},{"Type":1,"Content":")\n","OldLineNum":0,"NewLineNum":12,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":13,"NoNewline":false},{"Type":1,"Content":"func TestSaver_Save(t *testing.T) {\n","OldLineNum":0,"NewLineNum":14,"NoNewline":false},{"Type":1,"Content":"\tt.Parallel()\n","OldLineNum":0,"NewLineNum":15,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":16,"NoNewline":false},{"Type":1,"Content":"\tt.Run(\"appends case to new file\", func(t *testing.T) {\n","OldLineNum":0,"NewLineNum":17,"NoNewline":false},{"Type":1,"Content":"\t\tt.Parallel()\n","OldLineNum":0,"NewLineNum":18,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":19,"NoNewline":false},{"Type":1,"Content":"\t\tdir := t.TempDir()\n","OldLineNum":0,"NewLineNum":20,"NoNewline":false},{"Type":1,"Content":"\t\tpath := filepath.Join(dir, \"output.jsonl\")\n","OldLineNum":0,"NewLineNum":21,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":22,"NoNewline":false},{"Type":1,"Content":"\t\tsaver := jsonl.NewSaver()\n","OldLineNum":0,"NewLineNum":23,"NoNewline":false},{"Type":1,"Content":"\t\tevalCase := diffview.EvalCase{\n","OldLineNum":0,"NewLineNum":24,"NoNewline":false},{"Type":1,"Content":"\t\t\tInput: diffview.ClassificationInput{\n","OldLineNum":0,"NewLineNum":25,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tRepo:   \"test/repo\",\n","OldLineNum":0,"NewLineNum":26,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tBranch: \"main\",\n","OldLineNum":0,"NewLineNum":27,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tCommits: []diffview.CommitBrief{\n","OldLineNum":0,"NewLineNum":28,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t\t{Hash: \"abc123\", Message: \"Test commit\"},\n","OldLineNum":0,"NewLineNum":29,"NoNewline":false},{"Type":1,"Content":"\t\t\t\t},\n","OldLineNum":0,"NewLineNum":30,"NoNewline":false},{"Type":1,"Content":"\t\t\t},\n","OldLineNum":0,"NewLineNum":31,"NoNewline":false},{"Type":1,"Content":"\t\t\tStory: \u0026diffview.StoryClassification{\n","OldLineNum":0,"NewLineNum":32,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tChangeType: \"feature\",\n","OldLineNum":0,"NewLineNum":33,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tSummary:    \"Added feature\",\n","OldLineNum":0,"NewLineNum":34,"NoNewline":false},{"Type":1,"Content":"\t\t\t},\n","OldLineNum":0,"NewLineNum":35,"NoNewline":false},{"Type":1,"Content":"\t\t}\n","OldLineNum":0,"NewLineNum":36,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":37,"NoNewline":false},{"Type":1,"Content":"\t\terr := saver.Save(path, evalCase)\n","OldLineNum":0,"NewLineNum":38,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":39,"NoNewline":false},{"Type":1,"Content":"\t\trequire.NoError(t, err)\n","OldLineNum":0,"NewLineNum":40,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":41,"NoNewline":false},{"Type":1,"Content":"\t\t// Verify file contains the case\n","OldLineNum":0,"NewLineNum":42,"NoNewline":false},{"Type":1,"Content":"\t\tcontent, err := os.ReadFile(path)\n","OldLineNum":0,"NewLineNum":43,"NoNewline":false},{"Type":1,"Content":"\t\trequire.NoError(t, err)\n","OldLineNum":0,"NewLineNum":44,"NoNewline":false},{"Type":1,"Content":"\t\tassert.Contains(t, string(content), `\"repo\":\"test/repo\"`)\n","OldLineNum":0,"NewLineNum":45,"NoNewline":false},{"Type":1,"Content":"\t\tassert.Contains(t, string(content), `\"hash\":\"abc123\"`)\n","OldLineNum":0,"NewLineNum":46,"NoNewline":false},{"Type":1,"Content":"\t\tassert.Contains(t, string(content), `\"change_type\":\"feature\"`)\n","OldLineNum":0,"NewLineNum":47,"NoNewline":false},{"Type":1,"Content":"\t})\n","OldLineNum":0,"NewLineNum":48,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":49,"NoNewline":false},{"Type":1,"Content":"\tt.Run(\"appends to existing file\", func(t *testing.T) {\n","OldLineNum":0,"NewLineNum":50,"NoNewline":false},{"Type":1,"Content":"\t\tt.Parallel()\n","OldLineNum":0,"NewLineNum":51,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":52,"NoNewline":false},{"Type":1,"Content":"\t\tdir := t.TempDir()\n","OldLineNum":0,"NewLineNum":53,"NoNewline":false},{"Type":1,"Content":"\t\tpath := filepath.Join(dir, \"existing.jsonl\")\n","OldLineNum":0,"NewLineNum":54,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":55,"NoNewline":false},{"Type":1,"Content":"\t\t// Create file with existing content\n","OldLineNum":0,"NewLineNum":56,"NoNewline":false},{"Type":1,"Content":"\t\texisting := `{\"input\":{\"repo\":\"old/repo\",\"commits\":[]},\"story\":null}` + \"\\n\"\n","OldLineNum":0,"NewLineNum":57,"NoNewline":false},{"Type":1,"Content":"\t\trequire.NoError(t, os.WriteFile(path, []byte(existing), 0o644))\n","OldLineNum":0,"NewLineNum":58,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":59,"NoNewline":false},{"Type":1,"Content":"\t\tsaver := jsonl.NewSaver()\n","OldLineNum":0,"NewLineNum":60,"NoNewline":false},{"Type":1,"Content":"\t\tevalCase := diffview.EvalCase{\n","OldLineNum":0,"NewLineNum":61,"NoNewline":false},{"Type":1,"Content":"\t\t\tInput: diffview.ClassificationInput{\n","OldLineNum":0,"NewLineNum":62,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tRepo: \"new/repo\",\n","OldLineNum":0,"NewLineNum":63,"NoNewline":false},{"Type":1,"Content":"\t\t\t},\n","OldLineNum":0,"NewLineNum":64,"NoNewline":false},{"Type":1,"Content":"\t\t}\n","OldLineNum":0,"NewLineNum":65,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":66,"NoNewline":false},{"Type":1,"Content":"\t\terr := saver.Save(path, evalCase)\n","OldLineNum":0,"NewLineNum":67,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":68,"NoNewline":false},{"Type":1,"Content":"\t\trequire.NoError(t, err)\n","OldLineNum":0,"NewLineNum":69,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":70,"NoNewline":false},{"Type":1,"Content":"\t\t// Verify both lines exist\n","OldLineNum":0,"NewLineNum":71,"NoNewline":false},{"Type":1,"Content":"\t\tcontent, err := os.ReadFile(path)\n","OldLineNum":0,"NewLineNum":72,"NoNewline":false},{"Type":1,"Content":"\t\trequire.NoError(t, err)\n","OldLineNum":0,"NewLineNum":73,"NoNewline":false},{"Type":1,"Content":"\t\tlines := splitLines(string(content))\n","OldLineNum":0,"NewLineNum":74,"NoNewline":false},{"Type":1,"Content":"\t\tassert.Len(t, lines, 2)\n","OldLineNum":0,"NewLineNum":75,"NoNewline":false},{"Type":1,"Content":"\t\tassert.Contains(t, lines[0], `\"repo\":\"old/repo\"`)\n","OldLineNum":0,"NewLineNum":76,"NoNewline":false},{"Type":1,"Content":"\t\tassert.Contains(t, lines[1], `\"repo\":\"new/repo\"`)\n","OldLineNum":0,"NewLineNum":77,"NoNewline":false},{"Type":1,"Content":"\t})\n","OldLineNum":0,"NewLineNum":78,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":79,"NoNewline":false},{"Type":1,"Content":"\tt.Run(\"creates parent directories\", func(t *testing.T) {\n","OldLineNum":0,"NewLineNum":80,"NoNewline":false},{"Type":1,"Content":"\t\tt.Parallel()\n","OldLineNum":0,"NewLineNum":81,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":82,"NoNewline":false},{"Type":1,"Content":"\t\tdir := t.TempDir()\n","OldLineNum":0,"NewLineNum":83,"NoNewline":false},{"Type":1,"Content":"\t\tpath := filepath.Join(dir, \"nested\", \"deep\", \"output.jsonl\")\n","OldLineNum":0,"NewLineNum":84,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":85,"NoNewline":false},{"Type":1,"Content":"\t\tsaver := jsonl.NewSaver()\n","OldLineNum":0,"NewLineNum":86,"NoNewline":false},{"Type":1,"Content":"\t\tevalCase := diffview.EvalCase{\n","OldLineNum":0,"NewLineNum":87,"NoNewline":false},{"Type":1,"Content":"\t\t\tInput: diffview.ClassificationInput{Repo: \"test\"},\n","OldLineNum":0,"NewLineNum":88,"NoNewline":false},{"Type":1,"Content":"\t\t}\n","OldLineNum":0,"NewLineNum":89,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":90,"NoNewline":false},{"Type":1,"Content":"\t\terr := saver.Save(path, evalCase)\n","OldLineNum":0,"NewLineNum":91,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":92,"NoNewline":false},{"Type":1,"Content":"\t\trequire.NoError(t, err)\n","OldLineNum":0,"NewLineNum":93,"NoNewline":false},{"Type":1,"Content":"\t\tassert.FileExists(t, path)\n","OldLineNum":0,"NewLineNum":94,"NoNewline":false},{"Type":1,"Content":"\t})\n","OldLineNum":0,"NewLineNum":95,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":96,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":97,"NoNewline":false},{"Type":1,"Content":"func splitLines(s string) []string {\n","OldLineNum":0,"NewLineNum":98,"NoNewline":false},{"Type":1,"Content":"\tvar lines []string\n","OldLineNum":0,"NewLineNum":99,"NoNewline":false},{"Type":1,"Content":"\tstart := 0\n","OldLineNum":0,"NewLineNum":100,"NoNewline":false},{"Type":1,"Content":"\tfor i := 0; i \u003c len(s); i++ {\n","OldLineNum":0,"NewLineNum":101,"NoNewline":false},{"Type":1,"Content":"\t\tif s[i] == '\\n' {\n","OldLineNum":0,"NewLineNum":102,"NoNewline":false},{"Type":1,"Content":"\t\t\tif i \u003e start {\n","OldLineNum":0,"NewLineNum":103,"NoNewline":false},{"Type":1,"Content":"\t\t\t\tlines = append(lines, s[start:i])\n","OldLineNum":0,"NewLineNum":104,"NoNewline":false},{"Type":1,"Content":"\t\t\t}\n","OldLineNum":0,"NewLineNum":105,"NoNewline":false},{"Type":1,"Content":"\t\t\tstart = i + 1\n","OldLineNum":0,"NewLineNum":106,"NoNewline":false},{"Type":1,"Content":"\t\t}\n","OldLineNum":0,"NewLineNum":107,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":108,"NoNewline":false},{"Type":1,"Content":"\tif start \u003c len(s) {\n","OldLineNum":0,"NewLineNum":109,"NoNewline":false},{"Type":1,"Content":"\t\tlines = append(lines, s[start:])\n","OldLineNum":0,"NewLineNum":110,"NoNewline":false},{"Type":1,"Content":"\t}\n","OldLineNum":0,"NewLineNum":111,"NoNewline":false},{"Type":1,"Content":"\treturn lines\n","OldLineNum":0,"NewLineNum":112,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":113,"NoNewline":false}]}],"Extended":null},{"OldPath":"mock/eval.go","NewPath":"mock/eval.go","Operation":0,"IsBinary":false,"OldMode":33188,"NewMode":0,"Hunks":[{"OldStart":12,"OldCount":6,"NewStart":12,"NewCount":7,"Section":"var (","Lines":[{"Type":0,"Content":"\t_ diffview.JudgmentStore  = (*JudgmentStore)(nil)\n","OldLineNum":12,"NewLineNum":12,"NoNewline":false},{"Type":0,"Content":"\t_ diffview.RubricJudge    = (*RubricJudge)(nil)\n","OldLineNum":13,"NewLineNum":13,"NoNewline":false},{"Type":0,"Content":"\t_ diffview.Clipboard      = (*Clipboard)(nil)\n","OldLineNum":14,"NewLineNum":14,"NoNewline":false},{"Type":1,"Content":"\t_ diffview.EvalCaseSaver  = (*EvalCaseSaver)(nil)\n","OldLineNum":0,"NewLineNum":15,"NoNewline":false},{"Type":0,"Content":")\n","OldLineNum":15,"NewLineNum":16,"NoNewline":false},{"Type":0,"Content":"\n","OldLineNum":16,"NewLineNum":17,"NoNewline":false},{"Type":0,"Content":"// EvalCaseLoader is a mock implementation of diffview.EvalCaseLoader.\n","OldLineNum":17,"NewLineNum":18,"NoNewline":false}]},{"OldStart":54,"OldCount":3,"NewStart":55,"NewCount":12,"Section":"type Clipboard struct {","Lines":[{"Type":0,"Content":"func (c *Clipboard) Copy(content string) error {\n","OldLineNum":54,"NewLineNum":55,"NoNewline":false},{"Type":0,"Content":"\treturn c.CopyFn(content)\n","OldLineNum":55,"NewLineNum":56,"NoNewline":false},{"Type":0,"Content":"}\n","OldLineNum":56,"NewLineNum":57,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":58,"NoNewline":false},{"Type":1,"Content":"// EvalCaseSaver is a mock implementation of diffview.EvalCaseSaver.\n","OldLineNum":0,"NewLineNum":59,"NoNewline":false},{"Type":1,"Content":"type EvalCaseSaver struct {\n","OldLineNum":0,"NewLineNum":60,"NoNewline":false},{"Type":1,"Content":"\tSaveFn func(path string, c diffview.EvalCase) error\n","OldLineNum":0,"NewLineNum":61,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":62,"NoNewline":false},{"Type":1,"Content":"\n","OldLineNum":0,"NewLineNum":63,"NoNewline":false},{"Type":1,"Content":"func (s *EvalCaseSaver) Save(path string, c diffview.EvalCase) error {\n","OldLineNum":0,"NewLineNum":64,"NoNewline":false},{"Type":1,"Content":"\treturn s.SaveFn(path, c)\n","OldLineNum":0,"NewLineNum":65,"NoNewline":false},{"Type":1,"Content":"}\n","OldLineNum":0,"NewLineNum":66,"NoNewline":false}]}],"Extended":null}]}},"story":{"change_type":"feature","narrative":"entry-implementation","summary":"Implemented a 'save' keybinding ('e') in both the story viewer and eval review TUIs to capture curated examples for the evaluation dataset.","sections":[{"role":"interface","title":"Defining the Saver Contract","hunks":[{"file":"evalreview.go","hunk_index":0,"category":"core","collapsed":false}],"explanation":"Introduces the EvalCaseSaver interface as a domain abstraction for persisting evaluation cases, following the project's decoupling pattern."},{"role":"core","title":"JSONL Implementation","hunks":[{"file":"jsonl/saver.go","hunk_index":0,"category":"core","collapsed":false}],"explanation":"Provides a concrete implementation of the saver that appends EvalCase records to a JSONL file, ensuring parent directories exist before writing."},{"role":"supporting","title":"Eval Review Integration","hunks":[{"file":"bubbletea/eval.go","hunk_index":0,"category":"core","collapsed":false},{"file":"bubbletea/eval.go","hunk_index":1,"category":"core","collapsed":false},{"file":"bubbletea/eval.go","hunk_index":2,"category":"core","collapsed":false},{"file":"bubbletea/eval.go","hunk_index":3,"category":"core","collapsed":false},{"file":"bubbletea/eval.go","hunk_index":4,"category":"core","collapsed":false},{"file":"bubbletea/eval_keymap.go","hunk_index":0,"category":"systematic","collapsed":false},{"file":"bubbletea/eval_keymap.go","hunk_index":1,"category":"systematic","collapsed":false}],"explanation":"Extends the EvalModel to support case saving, including new options, keybindings, and UI hints in the help menu."},{"role":"supporting","title":"Story Viewer Integration","hunks":[{"file":"bubbletea/story.go","hunk_index":0,"category":"core","collapsed":false},{"file":"bubbletea/story.go","hunk_index":1,"category":"core","collapsed":false},{"file":"bubbletea/story.go","hunk_index":2,"category":"core","collapsed":false},{"file":"bubbletea/story.go","hunk_index":3,"category":"core","collapsed":false},{"file":"bubbletea/story.go","hunk_index":4,"category":"core","collapsed":false},{"file":"bubbletea/story.go","hunk_index":5,"category":"core","collapsed":false},{"file":"bubbletea/story.go","hunk_index":6,"category":"core","collapsed":false},{"file":"bubbletea/story_keymap.go","hunk_index":0,"category":"systematic","collapsed":false},{"file":"bubbletea/story_keymap.go","hunk_index":1,"category":"systematic","collapsed":false}],"explanation":"Similarly integrates the saver into the standard StoryModel, allowing users to 'curate' interesting diffs during normal usage."},{"role":"supporting","title":"CLI Entrypoints Wiring","hunks":[{"file":"cmd/diffstory/main.go","hunk_index":0,"category":"core","collapsed":false},{"file":"cmd/diffstory/main.go","hunk_index":1,"category":"core","collapsed":false},{"file":"cmd/diffstory/main.go","hunk_index":2,"category":"core","collapsed":false},{"file":"cmd/diffstory/main.go","hunk_index":3,"category":"core","collapsed":false},{"file":"cmd/diffstory/main.go","hunk_index":4,"category":"core","collapsed":false},{"file":"cmd/evalreview/main.go","hunk_index":0,"category":"core","collapsed":false},{"file":"cmd/evalreview/main.go","hunk_index":1,"category":"core","collapsed":false}],"explanation":"Updates the CLI tools to instantiate the JSONL saver and pass it into the Bubble Tea models."},{"role":"test","title":"Verification and Mocks","hunks":[{"file":"jsonl/saver_test.go","hunk_index":0,"category":"core","collapsed":false},{"file":"bubbletea/eval_test.go","hunk_index":0,"category":"core","collapsed":false},{"file":"bubbletea/story_test.go","hunk_index":0,"category":"core","collapsed":false},{"file":"bubbletea/story_test.go","hunk_index":1,"category":"core","collapsed":false},{"file":"mock/eval.go","hunk_index":0,"category":"systematic","collapsed":true,"collapse_text":"Update interface mocks"},{"file":"mock/eval.go","hunk_index":1,"category":"systematic","collapsed":true,"collapse_text":"Update interface mocks"}],"explanation":"Provides comprehensive tests for the JSONL saver and the UI save triggers, along with updated mocks for interface compliance."},{"role":"cleanup","title":"Project Tracking","hunks":[{"file":".beads/issues.jsonl","hunk_index":0,"category":"systematic","collapsed":true,"collapse_text":"Update task documentation"},{"file":".beads/issues.jsonl","hunk_index":1,"category":"systematic","collapsed":true,"collapse_text":"Close feature task"}],"explanation":"Updates internal issue tracking to reflect completion of the case capture feature."}]}}
